<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cython: Wrap a C++ extentsion of Python &mdash; Krystal Python 0.post1+gcfcd279 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Packaging: What, Why and How" href="packaging.html" />
    <link rel="prev" title="ambush" href="ambush.html" />
 
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-185617644-1']);
  _gaq.push(['_trackPageview']);
</script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #ff8fbe" >
            <a href="index.html" class="icon icon-home"> Krystal Python
          </a>
              <div class="version">
                0.post1+gcfcd279
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="philosophy.html">Philosophy of this Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="annotation.html">Typing and annotation</a></li>
<li class="toctree-l1"><a class="reference internal" href="assert.html">assert</a></li>
<li class="toctree-l1"><a class="reference internal" href="lambda.html">lambda</a></li>
<li class="toctree-l1"><a class="reference internal" href="dunder.html">Dunder methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="comparision.html">Chaining Comparison Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="zip.html">zip</a></li>
<li class="toctree-l1"><a class="reference internal" href="comprehension.html">Comprehension</a></li>
<li class="toctree-l1"><a class="reference internal" href="variables.html">Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="walrus.html">Walrus operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="copy.html">Deepcopy vs Shallow copy</a></li>
<li class="toctree-l1"><a class="reference internal" href="mutabledefault.html">Mutable default arguments</a></li>
<li class="toctree-l1"><a class="reference internal" href="dirvsdict.html">dir vs __dict__</a></li>
<li class="toctree-l1"><a class="reference internal" href="forelse.html">for else</a></li>
<li class="toctree-l1"><a class="reference internal" href="import.html">import</a></li>
<li class="toctree-l1"><a class="reference internal" href="scope.html">Scope</a></li>
<li class="toctree-l1"><a class="reference internal" href="starred.html">Starred expression</a></li>
<li class="toctree-l1"><a class="reference internal" href="try.html">try, except, else and finally</a></li>
<li class="toctree-l1"><a class="reference internal" href="iter.html">iter</a></li>
<li class="toctree-l1"><a class="reference internal" href="itertools.html">itertools</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_filter_reduce.html">Map, Filter and Reduce</a></li>
<li class="toctree-l1"><a class="reference internal" href="container.html">High performance container</a></li>
<li class="toctree-l1"><a class="reference internal" href="decorator.html">Decorator</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataclass.html">Case Study: dataclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="decoratormethod.html">A decorator as class method</a></li>
<li class="toctree-l1"><a class="reference internal" href="descriptor.html">Descriptor</a></li>
<li class="toctree-l1"><a class="reference internal" href="classmethod.html">classmethod, staticmethod and property</a></li>
<li class="toctree-l1"><a class="reference internal" href="functools.html">functools</a></li>
<li class="toctree-l1"><a class="reference internal" href="newvsinit.html">new vs  init</a></li>
<li class="toctree-l1"><a class="reference internal" href="super.html">super</a></li>
<li class="toctree-l1"><a class="reference internal" href="meta.html">Metaclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="singleton.html">Singleton</a></li>
<li class="toctree-l1"><a class="reference internal" href="abstractmethod.html">Abstractmethod</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading.html">Thread</a></li>
<li class="toctree-l1"><a class="reference internal" href="processing.html">Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="generator.html">Generator, yield and yield from</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio.html">asyncio</a></li>
<li class="toctree-l1"><a class="reference internal" href="future.html">Future</a></li>
<li class="toctree-l1"><a class="reference internal" href="concurrentfuture.html">Processing async vs concurrent.future</a></li>
<li class="toctree-l1"><a class="reference internal" href="pytest.html">pytest with contest and parameterize</a></li>
<li class="toctree-l1"><a class="reference internal" href="pdb.html">Debugging by pdb</a></li>
<li class="toctree-l1"><a class="reference internal" href="searchmethod.html">Search methods’ host class</a></li>
<li class="toctree-l1"><a class="reference internal" href="inspect.html">Inspect function caller</a></li>
<li class="toctree-l1"><a class="reference internal" href="conda.html">Conda Virtual Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="argparse.html">argparse</a></li>
<li class="toctree-l1"><a class="reference internal" href="vscode.html">vscode</a></li>
<li class="toctree-l1"><a class="reference internal" href="pythontutor.html">pythontutor</a></li>
<li class="toctree-l1"><a class="reference internal" href="rst.html">RST</a></li>
<li class="toctree-l1"><a class="reference internal" href="ambush.html">ambush</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cython: Wrap a C++ extentsion of Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#why">Why</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what">What</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-the-architecture-of-a-python-project-with-cython-extension">How: The architecture of a python project with cython extension</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#a-work-flow">A work flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#orgnize">Orgnize</a></li>
<li class="toctree-l3"><a class="reference internal" href="#stay-with-h-and-cpp">Stay with .h and .cpp</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pyx">.pyx</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pxd-file">.pxd file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#install-package">Install package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup-py">setup.py</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-setup-cfg-to-make-things-easy">Use setup.cfg to make things easy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-cython-with-jupyter-notebook-ipython">Use cython with jupyter notebook/ipython</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#practice-with-c-and-python-community-eigne-and-numpy">Practice with C and Python community: Eigne and Numpy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-get-eigen-library">How to get Eigen library</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-get-numpy-package">How to get numpy package</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-get-cpp-std-libray">How to get cpp std libray</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#when-you-use-cdef">When you use cdef</a></li>
<li class="toctree-l2"><a class="reference internal" href="#numpy-import-vs-cimport">numpy import vs cimport</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cython-fatal-error-numpy-arrayobject-h-no-such-file-or-directory">Cython: “fatal error: numpy/arrayobject.h: No such file or directory”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#directive-comments">Directive comments</a></li>
<li class="toctree-l2"><a class="reference internal" href="#def-vs-cdef-vs-cpdef">def vs cdef vs cpdef</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cannot-find-eign-core">Cannot find Eign/Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-do-i-wrap-a-c-class-with-cython">How do I wrap a C class with cython</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ci-cd-a-cython-project">CI/CD a Cython Project</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pytest">pytest</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#faq">FAQ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#use-cdef">Use cdef</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cython-file-names">cython file names</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup-py-ext-modules">setup.py ext_modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cython-annotation">cython annotation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="packaging.html">Packaging: What, Why and How</a></li>
<li class="toctree-l1"><a class="reference internal" href="setuptools.html">setuptools</a></li>
<li class="toctree-l1"><a class="reference internal" href="github_actions.html">Github Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="alternatives_cpp_plus_python.html">Use C++ function/class in python</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #ff8fbe" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Krystal Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Cython: Wrap a C++ extentsion of Python</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/cython.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cython-wrap-a-c-extentsion-of-python">
<h1>Cython: Wrap a C++ extentsion of Python<a class="headerlink" href="#cython-wrap-a-c-extentsion-of-python" title="Permalink to this heading">¶</a></h1>
<p>The index of this document will include</p>
<p>A general archetecture of cython project</p>
<p>Should include as much as possible build information here</p>
<p>A example from example directory</p>
<p>A real world example from rble lib</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>A numpy <strong>float</strong> is a C <strong>double</strong>!</p>
</div>
<section id="why">
<h2>Why<a class="headerlink" href="#why" title="Permalink to this heading">¶</a></h2>
<p>If you are thinking whether you need cython, in most case, you don’t need it. Cython might be a good option if both conditions belwo satisfied.</p>
<blockquote>
<div><ul class="simple">
<li><p>You care more about running time instead of engineering time.</p></li>
<li><p>You have concluded that your engineering logic works in a slower language, optimization is next step.</p></li>
</ul>
</div></blockquote>
</section>
<section id="what">
<h2>What<a class="headerlink" href="#what" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>Extension is python module you write in other language, in here we refer C/C++</p></li>
<li><p>Cython will just use whatever standard C compiler to compile it to <em>.so</em> file</p></li>
<li><p>Eventually, python allow you import it</p></li>
</ol>
</section>
<section id="how-the-architecture-of-a-python-project-with-cython-extension">
<h2>How: The architecture of a python project with cython extension<a class="headerlink" href="#how-the-architecture-of-a-python-project-with-cython-extension" title="Permalink to this heading">¶</a></h2>
<p>A conoventional architecture and naming rule is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">PROJECT</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">MODULE</span><span class="o">&gt;</span>
    <span class="n">include</span>
      <span class="o">&lt;</span><span class="n">REAL_NAME</span><span class="o">&gt;.</span><span class="n">h</span>
    <span class="n">src</span>
      <span class="o">&lt;</span><span class="n">REAL_NAME</span><span class="o">&gt;.</span><span class="n">cpp</span>
    <span class="n">python</span>
      <span class="o">&lt;</span><span class="n">REAL_NAME</span><span class="o">&gt;</span><span class="n">_wrapper</span><span class="o">.</span><span class="n">pyx</span>
      <span class="o">&lt;</span><span class="n">REAL_NAME</span><span class="o">&gt;</span><span class="n">_interface</span><span class="o">.</span><span class="n">pxd</span>
    <span class="n">tests</span>
      <span class="o">.</span><span class="n">py</span>
  <span class="n">setup</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Important! DO NOT name the <em>.pyx</em> file the same as your <em>.cpp</em> file! When the cythonize function is
called later, a new <em>.cpp</em> file with the same name as your <em>.pyx</em> file is generated. If you name both
your original <em>.cpp</em> and your <em>.pyx</em> file the same, your <em>.cpp</em> file will be overwritten! Which is bad.</p>
<p>Though there is tldr <a class="reference external" href="https://cython.readthedocs.io/en/latest/src/userguide/external_C_code.html#resolving-naming-conflicts-c-name-specifications">solution</a> if you really need to name them exactly same.</p>
</div>
<section id="a-work-flow">
<h3>A work flow<a class="headerlink" href="#a-work-flow" title="Permalink to this heading">¶</a></h3>
<a class="reference internal image-reference" href="_images/cython.svg"><img alt="_images/cython.svg" class="align-center" src="_images/cython.svg" width="1000" /></a>
</section>
<section id="orgnize">
<h3>Orgnize<a class="headerlink" href="#orgnize" title="Permalink to this heading">¶</a></h3>
<p>A Cython module can be split into two parts: a definition file with a .pxd suffix, containing C declarations that are to be available to other Cython modules, and an implementation file with a .pyx/.py suffix, containing everything else. When a module wants to use something declared in another module’s definition file, it imports it using the cimport statement or using special cython.cimports package.</p>
<p>A .pxd file that consists solely of extern declarations does not need to correspond to an actual .pyx/.py file or Python module. This can make it a convenient place to put common declarations, for example declarations of functions from an external library that one wants to use in several modules.</p>
<p>When you cimport a module called modulename, the Cython compiler searches for a file called modulename.pxd. It searches for this file along the path for include files (as specified by -I command line options or the include_path option to cythonize()), as well as sys.path.</p>
<p>Using package_data to install .pxd files in your setup.py script allows other packages to cimport items from your module as a dependency.</p>
<p>Also, whenever you compile a file modulename.pyx/modulename.py, the corresponding definition file modulename.pxd is first searched for along the include path (but not sys.path), and if found, it is processed before processing the .pyx file.</p>
</section>
<section id="stay-with-h-and-cpp">
<h3>Stay with .h and .cpp<a class="headerlink" href="#stay-with-h-and-cpp" title="Permalink to this heading">¶</a></h3>
<p>The <em>.h</em> files in <em>include</em> and <em>.cpp</em> files in <em>src</em> are just pure/raw c++ files. They should be 100% legal in a pure c++ environment.</p>
</section>
<section id="pyx">
<h3>.pyx<a class="headerlink" href="#pyx" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="../../examples/cython/compute_wrapper.pyx">compute_wrapper.pyx</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># distutils: language = c++</span>

<span class="n">cimport</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">compute_interface</span> <span class="n">cimport</span> <span class="n">Rectangle</span>
<span class="kn">from</span> <span class="nn">compute_interface</span> <span class="n">cimport</span> <span class="n">Vec4d</span><span class="p">,</span> <span class="n">Vec4f</span>
<span class="kn">from</span> <span class="nn">compute_interface</span> <span class="n">cimport</span> <span class="n">ccompute_d</span><span class="p">,</span> <span class="n">ccompute_f</span>
<span class="c1"># rectangle is the name of .pxd from rectangle.pxd</span>
<span class="c1"># Rectangle is the class name defined by cdef in rectangle.pxd </span>


<span class="c1"># Create a Cython extension type which holds a C++ instance</span>
<span class="c1"># as an attribute and create a bunch of forwarding methods</span>
<span class="c1"># Python extension type.</span>
<span class="n">cdef</span> <span class="k">class</span> <span class="nc">PyRectangle</span><span class="p">:</span>
    <span class="n">cdef</span> <span class="n">Rectangle</span> <span class="n">c_rect</span>  <span class="c1"># Hold a C++ instance which we&#39;re wrapping</span>

    <span class="k">def</span> <span class="nf">__cinit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">int</span> <span class="n">x0</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y0</span><span class="p">,</span> <span class="nb">int</span> <span class="n">x1</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_rect</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_rect</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cdef</span> <span class="nb">int</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_rect</span><span class="o">.</span><span class="n">getSize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">width</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">height</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>

    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_rect</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>


<span class="n">cdef</span> <span class="n">Vec4d</span> <span class="n">NumpyToVector4d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="s1">&#39;double&#39;</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">]</span> <span class="n">x</span><span class="p">):</span>
  <span class="n">cdef</span> <span class="n">Vec4d</span> <span class="n">cx</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">cx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

  <span class="k">return</span> <span class="n">cx</span>

<span class="n">cdef</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">]</span> <span class="n">Vector4dToNumpy</span> <span class="p">(</span><span class="n">Vec4d</span> <span class="n">cx</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="p">((</span><span class="n">cx</span><span class="o">.</span><span class="n">rows</span><span class="p">()),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;double&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">rows</span><span class="p">()):</span>
        <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="n">cpdef</span> <span class="n">compute_d</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Vector4dToNumpy</span><span class="p">(</span><span class="n">ccompute_d</span><span class="p">(</span><span class="n">NumpyToVector4d</span><span class="p">(</span><span class="n">arr</span><span class="p">)))</span>

<span class="n">cdef</span> <span class="n">Vec4f</span> <span class="n">NumpyToVector4f</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">]</span> <span class="n">x</span><span class="p">):</span>
  <span class="n">cdef</span> <span class="n">Vec4f</span> <span class="n">cx</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">cx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

  <span class="k">return</span> <span class="n">cx</span>

<span class="n">cdef</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="n">Vector4fToNumpy</span> <span class="p">(</span><span class="n">Vec4f</span> <span class="n">cx</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="p">((</span><span class="n">cx</span><span class="o">.</span><span class="n">rows</span><span class="p">()),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">cx</span><span class="o">.</span><span class="n">rows</span><span class="p">()):</span>
        <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">cx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="n">cpdef</span> <span class="n">compute_f</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Vector4fToNumpy</span><span class="p">(</span><span class="n">ccompute_f</span><span class="p">(</span><span class="n">NumpyToVector4f</span><span class="p">(</span><span class="n">arr</span><span class="p">)))</span>
</pre></div>
</div>
<p>Here we are basiclly write python code(Cython extension type) as a wrapper to wrap the logic of .cpp file. When I said wrapping C function,
I mean we define a python function and inside it, we just call our c function.</p>
<p>In my naive understanding, this file contain rewritten python-ish code that matches your function and class
in c++ files.</p>
<p>At the beginning, you need cimport your c class definition(It represent cpp class in a python/cython class way)
from pxd module. If you have ‘compute_interface.pxd’, then</p>
<p>In the python class that we are about to write, you need use cdef to define a python-ish class for latter use.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cdef</span> <span class="k">class</span> <span class="nc">PyRectangle</span><span class="p">:</span>
    <span class="n">cdef</span> <span class="n">Rectangle</span> <span class="n">c_rect</span>  <span class="c1"># Hold a C++ instance which we&#39;re wrapping</span>
</pre></div>
</div>
<p>which has a c object as an attribute</p>
<blockquote>
<div><ul class="simple">
<li><p>declare it by c class which was cimport just above. This declaration usually take place in class attribute
location.</p></li>
</ul>
<ul class="simple">
<li><p>In __cinit__ magic method, construct c object as a attribute of python class.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__cinit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">int</span> <span class="n">x0</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y0</span><span class="p">,</span> <span class="nb">int</span> <span class="n">x1</span><span class="p">,</span> <span class="nb">int</span> <span class="n">y1</span><span class="p">):</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">c_rect</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Next, you just need to rewrite all method you need by calling c object methods, like</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_rect</span><span class="o">.</span><span class="n">getArea</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="pxd-file">
<h3>.pxd file<a class="headerlink" href="#pxd-file" title="Permalink to this heading">¶</a></h3>
<p>It is a definition file, the meanding of “d” in “pxd”. The role of .pxd file is like a shared header file of cython code,</p>
<blockquote>
<div><ul class="simple">
<li><p>It is a shared inclusing</p></li>
<li><p>It give you a chance to select what you wanna declare from C external, not always all</p></li>
</ul>
</div></blockquote>
<p>Use c++ file as source. Declare python/cython class with cdef</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="k">cdef</span> <span class="kr">extern</span> <span class="k">from</span> <span class="s">&quot;Rectangle.h&quot;</span> <span class="n">namespace</span> <span class="s">&quot;shapes&quot;</span><span class="p">:</span>
  <span class="k">cdef</span> <span class="kt">cppclass</span> <span class="nf">Rectangle</span><span class="p">:</span>
</pre></div>
</div>
<p>Here the <em>extern</em> is refer that the declaration of variables/function come from external.
Next we declare each method and private members</p>
<div class="highlight-cython notranslate"><div class="highlight"><pre><span></span><span class="n">Rectangle</span><span class="p">()</span> <span class="k">except</span> <span class="o">+</span>
<span class="n">Rectangle</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">except</span> <span class="o">+</span>
<span class="nb">int</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span>
<span class="nb">int</span> <span class="n">getArea</span><span class="p">()</span>
<span class="n">void</span> <span class="n">getSize</span><span class="p">(</span><span class="nb">int</span><span class="o">*</span> <span class="n">width</span><span class="p">,</span> <span class="nb">int</span><span class="o">*</span> <span class="n">height</span><span class="p">)</span>
<span class="n">void</span> <span class="n">move</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may feel that line</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cdef</span> <span class="n">extern</span> <span class="kn">from</span> <span class="s2">&quot;&lt;HEADER&gt;.h&quot;</span>
</pre></div>
</div>
<p>should be enough to inlcude whatever you need, and the line below like</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Rectangle</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">except</span> <span class="o">+</span>
</pre></div>
</div>
<p>is kinda of redundant, yes!. kinda, here is reason</p>
<ul class="simple">
<li><p>cython is welcome to more automation but based on my knowledge this has not been impolementd and it’s time expensive.</p></li>
<li><p>here, it’s more like checking purpose to check function you will use is matching the thing in you c header file.</p></li>
<li><p>you have a chance to only declare function you need , not include all of them.</p></li>
</ul>
</div>
<p><em>expcept +</em> here is make sure that python will raise the exception of c++ error.</p>
</section>
</section>
<section id="install-package">
<h2>Install package<a class="headerlink" href="#install-package" title="Permalink to this heading">¶</a></h2>
<section id="setup-py">
<h3>setup.py<a class="headerlink" href="#setup-py" title="Permalink to this heading">¶</a></h3>
<p>make sure code below are in setup.py</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">Extension</span>

<span class="kn">from</span> <span class="nn">Cython.Build</span> <span class="kn">import</span> <span class="n">cythonize</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="n">setup</span><span class="p">(</span>
    <span class="n">ext_modules</span><span class="o">=</span><span class="n">cythonize</span><span class="p">(</span><span class="n">Extension</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;compute_wrapper&quot;</span><span class="p">,</span>
                                    <span class="n">sources</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;compute_wrapper.pyx&quot;</span><span class="p">,</span>
                                             <span class="s2">&quot;compute.cpp&quot;</span><span class="p">],</span>
                                    <span class="c1"># Either put .cpp sources file here</span>
                                    <span class="c1"># OR by using directive in .pyx file,</span>
                                    <span class="c1">#       # directive: sources = compute.cpp</span>
                                    <span class="c1">#</span>
                                    <span class="c1"># OR by putting code inside .pxd file</span>
                                    <span class="c1">#       cdef extern from &quot;compute.cpp&quot;:</span>
                                    <span class="c1">#           pass</span>
                                    <span class="c1">#</span>
                                    <span class="n">include_dirs</span><span class="o">=</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">get_include</span><span class="p">()],</span>
                                    <span class="n">language</span><span class="o">=</span><span class="s2">&quot;c++&quot;</span><span class="p">,</span>
                                    <span class="n">extra_compile_args</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;-std=c++11&quot;</span><span class="p">],</span>
                                    <span class="n">define_macros</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;NPY_NO_DEPRECATED_API&quot;</span><span class="p">,</span>
                                                    <span class="s2">&quot;NPY_1_7_API_VERSION&quot;</span><span class="p">)]</span>
                                    <span class="p">),</span>
                          <span class="n">compiler_directives</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;language_level&#39;</span><span class="p">:</span> <span class="s1">&#39;3str&#39;</span><span class="p">}</span>
                          <span class="c1"># This is for eliminate warning, though it is not</span>
                          <span class="c1"># very necessary.</span>
                          <span class="c1"># FutureWarning: Cython directive &#39;language_level&#39;</span>
                          <span class="c1"># not set, using &#39;3str&#39; for now (Py3). This has</span>
                          <span class="c1"># changed from earlier releases!</span>
                          <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Here the meaning of argument</p>
<ul class="simple">
<li><p><strong>name</strong>: A architecture name that seperated by ‘.’(dot), dot is not meaning of file type</p></li>
<li><p><strong>sources</strong>: A list of source files that not being <em>cdef</em> in <em>.pxd</em> file</p></li>
</ul>
<p>A minimal command run is below</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python setup.py build_ext
</pre></div>
</div>
<p>However if you need run the so in current file, you need add <em>–inplace</em> flag and if you wanna force to recompile each time, you need <em>–force</em></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python setup.py build_ext --inplace --force
</pre></div>
</div>
</section>
<section id="use-setup-cfg-to-make-things-easy">
<h3>Use setup.cfg to make things easy<a class="headerlink" href="#use-setup-cfg-to-make-things-easy" title="Permalink to this heading">¶</a></h3>
<p>There are tons of flag, so to make it easy, you could write all options and flag in a <em>setup.cfg</em>.</p>
<p>You could config <em>setup.cfg</em> by instruction here
<a class="reference external" href="https://docs.python.org/3/distutils/configfile.html">https://docs.python.org/3/distutils/configfile.html</a></p>
<p>For example, configure by <em>setup.cfg</em> in a format like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">command</span><span class="p">]</span>
<span class="n">option</span><span class="o">=</span><span class="n">value</span>
<span class="o">...</span>
</pre></div>
</div>
<p>the running code above could be configured</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>build_ext<span class="o">]</span>
<span class="nv">inplace</span><span class="o">=</span><span class="m">1</span>
<span class="nv">force</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
<p>and you could just run and the flags will add to the end automatically</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ python setup.py build_ext
</pre></div>
</div>
</section>
<section id="use-cython-with-jupyter-notebook-ipython">
<h3>Use cython with jupyter notebook/ipython<a class="headerlink" href="#use-cython-with-jupyter-notebook-ipython" title="Permalink to this heading">¶</a></h3>
<p>in the top of notebook/ipython
.. code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">load_ext</span> <span class="n">cythonmagic</span>
</pre></div>
</div>
<p>In the top your code cell or ipython
.. code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">cython</span>
<span class="c1"># write your code</span>
</pre></div>
</div>
</section>
</section>
<section id="practice-with-c-and-python-community-eigne-and-numpy">
<h2>Practice with C and Python community: Eigne and Numpy<a class="headerlink" href="#practice-with-c-and-python-community-eigne-and-numpy" title="Permalink to this heading">¶</a></h2>
<section id="how-to-get-eigen-library">
<h3>How to get Eigen library<a class="headerlink" href="#how-to-get-eigen-library" title="Permalink to this heading">¶</a></h3>
</section>
<section id="how-to-get-numpy-package">
<h3>How to get numpy package<a class="headerlink" href="#how-to-get-numpy-package" title="Permalink to this heading">¶</a></h3>
</section>
<section id="how-to-get-cpp-std-libray">
<h3>How to get cpp std libray<a class="headerlink" href="#how-to-get-cpp-std-libray" title="Permalink to this heading">¶</a></h3>
<p><a class="reference external" href="https://cython.readthedocs.io/en/latest/src/userguide/wrapping_CPlusPlus.html?highlight=Rectangle#standard-library">https://cython.readthedocs.io/en/latest/src/userguide/wrapping_CPlusPlus.html?highlight=Rectangle#standard-library</a></p>
<p>A code here also work as good examples on how to declare C++ classes.</p>
<p>The code below perfectly show us the logistic to mix Eigen and Numpy with Cython. It trys call a <em>CalcPointAcceleration</em> from python which transfers all variables to cpp and use some cpp source code with Eigen do real math calculation and then transfer variables back to Numpy.</p>
<p>.pyx file is in
<a class="reference external" href="https://github.com/rbdl/rbdl/blob/master/python/rbdl-wrapper.pyx#L1873">https://github.com/rbdl/rbdl/blob/master/python/rbdl-wrapper.pyx#L1873</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">cimport</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="n">cimport</span> <span class="n">csvd</span>

<span class="o">...</span>

<span class="k">def</span> <span class="nf">CalcPointAcceleration</span> <span class="p">(</span><span class="n">Model</span> <span class="n">model</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">]</span> <span class="n">q</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">]</span> <span class="n">qdot</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">]</span> <span class="n">qddot</span><span class="p">,</span>
        <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">body_id</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">double</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">]</span> <span class="n">body_point_position</span><span class="p">,</span>
        <span class="n">update_kinematics</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Vector3dToNumpy</span> <span class="p">(</span><span class="n">crbdl</span><span class="o">.</span><span class="n">CalcPointAcceleration</span> <span class="p">(</span>
            <span class="n">model</span><span class="o">.</span><span class="n">thisptr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">NumpyToVectorNd</span> <span class="p">(</span><span class="n">q</span><span class="p">),</span>
            <span class="n">NumpyToVectorNd</span> <span class="p">(</span><span class="n">qdot</span><span class="p">),</span>
            <span class="n">NumpyToVectorNd</span> <span class="p">(</span><span class="n">qddot</span><span class="p">),</span>
            <span class="n">body_id</span><span class="p">,</span>
            <span class="n">NumpyToVector3d</span> <span class="p">(</span><span class="n">body_point_position</span><span class="p">),</span>
            <span class="n">update_kinematics</span>
            <span class="p">))</span>
</pre></div>
</div>
<p>If we look close of return line, from inside to outside:</p>
<ol class="arabic simple">
<li><p>Call NumpyToEigen-ish function, here it call <a class="reference external" href="https://github.com/rbdl/rbdl/blob/master/python/rbdl-wrapper.pyx#L533">NumpyToVectorNd</a></p></li>
<li><p>Call Actuall function by <em>crbdl.function</em> name. This <em>function</em> is shown in</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>crbdl.pxd by cdef and cdef extern from “&lt;HEADER.h&gt;” namespace “&lt;NAMESPACE&gt;”:</p></li>
<li><p>.h file</p></li>
<li><p>.cpp file</p></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="3">
<li><p>Call EigenToNumpy-ish function, here it call <em>Vector2dToNumpy</em></p></li>
</ol>
<p>.h file
<a class="reference external" href="https://github.com/rbdl/rbdl/blob/242bf36fbae13ef2b67414e23844f59f97d24ea1/include/rbdl/Kinematics.h#L270">https://github.com/rbdl/rbdl/blob/242bf36fbae13ef2b67414e23844f59f97d24ea1/include/rbdl/Kinematics.h#L270</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Math</span><span class="p">::</span><span class="n">Vector3d</span> <span class="n">CalcPointAcceleration</span> <span class="p">(</span>
    <span class="n">Model</span> <span class="o">&amp;</span><span class="n">model</span><span class="p">,</span>
    <span class="n">const</span> <span class="n">Math</span><span class="p">::</span><span class="n">VectorNd</span> <span class="o">&amp;</span><span class="n">Q</span><span class="p">,</span>
    <span class="n">const</span> <span class="n">Math</span><span class="p">::</span><span class="n">VectorNd</span> <span class="o">&amp;</span><span class="n">QDot</span><span class="p">,</span>
    <span class="n">const</span> <span class="n">Math</span><span class="p">::</span><span class="n">VectorNd</span> <span class="o">&amp;</span><span class="n">QDDot</span><span class="p">,</span>
    <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">body_id</span><span class="p">,</span>
    <span class="n">const</span> <span class="n">Math</span><span class="p">::</span><span class="n">Vector3d</span> <span class="o">&amp;</span><span class="n">point_position</span><span class="p">,</span>
    <span class="nb">bool</span> <span class="n">update_kinematics</span> <span class="o">=</span> <span class="n">true</span>
    <span class="p">);</span>
</pre></div>
</div>
<p>.cpp file
<a class="reference external" href="https://github.com/rbdl/rbdl/blob/242bf36fbae13ef2b67414e23844f59f97d24ea1/src/Kinematics.cc#L513">https://github.com/rbdl/rbdl/blob/242bf36fbae13ef2b67414e23844f59f97d24ea1/src/Kinematics.cc#L513</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Vector3d</span> <span class="n">CalcPointAcceleration</span> <span class="p">(</span>
    <span class="n">Model</span> <span class="o">&amp;</span><span class="n">model</span><span class="p">,</span>
    <span class="n">const</span> <span class="n">VectorNd</span> <span class="o">&amp;</span><span class="n">Q</span><span class="p">,</span>
    <span class="n">const</span> <span class="n">VectorNd</span> <span class="o">&amp;</span><span class="n">QDot</span><span class="p">,</span>
    <span class="n">const</span> <span class="n">VectorNd</span> <span class="o">&amp;</span><span class="n">QDDot</span><span class="p">,</span>
    <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">body_id</span><span class="p">,</span>
    <span class="n">const</span> <span class="n">Vector3d</span> <span class="o">&amp;</span><span class="n">point_position</span><span class="p">,</span>
    <span class="nb">bool</span> <span class="n">update_kinematics</span><span class="p">)</span> <span class="p">{</span>
</pre></div>
</div>
<p>.pxd file
<a class="reference external" href="https://github.com/rbdl/rbdl/blob/242bf36fbae13ef2b67414e23844f59f97d24ea1/python/crbdl.pxd#L254">https://github.com/rbdl/rbdl/blob/242bf36fbae13ef2b67414e23844f59f97d24ea1/python/crbdl.pxd#L254</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cdef</span> <span class="n">extern</span> <span class="kn">from</span> <span class="s2">&quot;&lt;rbdl/Kinematics.h&gt;&quot;</span> <span class="n">namespace</span> <span class="s2">&quot;RigidBodyDynamics&quot;</span><span class="p">:</span>
    <span class="n">cdef</span> <span class="n">Vector3d</span> <span class="n">CalcPointAcceleration</span> <span class="p">(</span><span class="n">Model</span><span class="o">&amp;</span> <span class="n">model</span><span class="p">,</span>
      <span class="n">const</span> <span class="n">VectorNd</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">,</span>
      <span class="n">const</span> <span class="n">VectorNd</span> <span class="o">&amp;</span><span class="n">qdot</span><span class="p">,</span>
      <span class="n">const</span> <span class="n">VectorNd</span> <span class="o">&amp;</span><span class="n">qddot</span><span class="p">,</span>
      <span class="n">const</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">body_id</span><span class="p">,</span>
      <span class="n">const</span> <span class="n">Vector3d</span> <span class="o">&amp;</span><span class="n">body_point_coordinates</span><span class="p">,</span>
      <span class="nb">bool</span> <span class="n">update_kinematics</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="when-you-use-cdef">
<h2>When you use cdef<a class="headerlink" href="#when-you-use-cdef" title="Permalink to this heading">¶</a></h2>
<p>When you need define something that need to be used later in python but its come from cpp(in .h file and .cpp file)</p>
</section>
<section id="numpy-import-vs-cimport">
<h2>numpy import vs cimport<a class="headerlink" href="#numpy-import-vs-cimport" title="Permalink to this heading">¶</a></h2>
<p>how to import or cimport numpy in .pyx file.
<a class="reference external" href="https://stackoverflow.com/questions/20268228/cython-cimport-and-import-numpy-as-both-np">https://stackoverflow.com/questions/20268228/cython-cimport-and-import-numpy-as-both-np</a></p>
</section>
<section id="cython-fatal-error-numpy-arrayobject-h-no-such-file-or-directory">
<h2>Cython: “fatal error: numpy/arrayobject.h: No such file or directory”<a class="headerlink" href="#cython-fatal-error-numpy-arrayobject-h-no-such-file-or-directory" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://stackoverflow.com/a/14657667/10642305">https://stackoverflow.com/a/14657667/10642305</a></p>
</section>
<section id="directive-comments">
<h2>Directive comments<a class="headerlink" href="#directive-comments" title="Permalink to this heading">¶</a></h2>
<p>The comments in cython related file are compling directives which do take effect.
Ref:
<a class="reference external" href="https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html#how-to-set-directives">https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html#how-to-set-directives</a>
The directive is prefered to setup in setup.py by this
<a class="reference external" href="https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html#how-to-set-directives">https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html#how-to-set-directives</a></p>
</section>
<section id="def-vs-cdef-vs-cpdef">
<h2>def vs cdef vs cpdef<a class="headerlink" href="#def-vs-cdef-vs-cpdef" title="Permalink to this heading">¶</a></h2>
<p><strong>cdef</strong> is basiclly define a function that only workable inside package. it cannot be used by python directly. It is local to current file. If you wanna use it by python directly, aka
do something like below</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pkg.pyx_module</span> <span class="kn">import</span> <span class="n">function_defined_inside_pyx</span>
<span class="n">function_defined_inside_pyx</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>The function_defined_inside_pyx has to be defined by <strong>cpdef</strong>.
<strong>cpdef</strong> could be called by local C and externally Python</p>
<p>Q: Why don’t always use <strong>cpdef</strong></p>
<p><strong>cpdef</strong> has some constrain in taking argument, it cannot take some C argument like pointers, ex float * x
other than that, yes, you could always use cpdef.</p>
<p>Thing to remember is always use <strong>def</strong> and <strong>cpdef</strong> to expose function to outside</p>
</section>
<section id="cannot-find-eign-core">
<h2>Cannot find Eign/Core<a class="headerlink" href="#cannot-find-eign-core" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://github.com/opencv/opencv/issues/14868">https://github.com/opencv/opencv/issues/14868</a></p>
</section>
<section id="how-do-i-wrap-a-c-class-with-cython">
<h2>How do I wrap a C class with cython<a class="headerlink" href="#how-do-i-wrap-a-c-class-with-cython" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://stackoverflow.com/questions/8933263/how-do-i-wrap-a-c-class-with-cython">https://stackoverflow.com/questions/8933263/how-do-i-wrap-a-c-class-with-cython</a></p>
</section>
<section id="ci-cd-a-cython-project">
<h2>CI/CD a Cython Project<a class="headerlink" href="#ci-cd-a-cython-project" title="Permalink to this heading">¶</a></h2>
<section id="pytest">
<h3>pytest<a class="headerlink" href="#pytest" title="Permalink to this heading">¶</a></h3>
<p>The pytes isn’t work well with cython, before test, you need install editable by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
<p>If you miss <em>-e</em>, it won’t work.</p>
</section>
</section>
<section id="faq">
<h2>FAQ<a class="headerlink" href="#faq" title="Permalink to this heading">¶</a></h2>
<ol class="arabic simple">
<li></li>
</ol>
<p>Something like warning below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">cppTypes</span><span class="o">.</span><span class="n">h</span><span class="p">:</span><span class="mi">17</span><span class="p">:</span><span class="mi">16</span><span class="p">:</span> <span class="n">warning</span><span class="p">:</span> <span class="n">alias</span> <span class="n">declarations</span> <span class="n">are</span> <span class="n">a</span> <span class="n">C</span><span class="o">++</span><span class="mi">11</span> <span class="n">extension</span> <span class="p">[</span><span class="o">-</span><span class="n">Wc</span><span class="o">++</span><span class="mi">11</span><span class="o">-</span><span class="n">extensions</span><span class="p">]</span>
<span class="n">using</span> <span class="n">RotMat</span> <span class="o">=</span> <span class="n">typename</span> <span class="n">Eigen</span><span class="p">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>could be solved by setting up <em>language</em> of <em>Extension</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">language</span><span class="o">=</span><span class="s2">&quot;c++&quot;</span>
</pre></div>
</div>
<p>in setup.py</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">setup</span><span class="p">(</span>
    <span class="n">ext_modules</span><span class="o">=</span><span class="n">cythonize</span><span class="p">(</span><span class="n">Extension</span><span class="p">(</span><span class="s2">&quot;rect&quot;</span><span class="p">,</span>
                                    <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rect.pyx&quot;</span><span class="p">],</span>
                                    <span class="n">includedirs</span><span class="o">=</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">get_include</span><span class="p">()],</span>
                                    <span class="n">language</span><span class="o">=</span><span class="s2">&quot;c++&quot;</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li></li>
</ol>
<p>Something like error below</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rect</span><span class="o">.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">973</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span> <span class="n">fatal</span> <span class="n">error</span><span class="p">:</span> <span class="s1">&#39;numpy/arrayobject.h&#39;</span> <span class="n">file</span> <span class="ow">not</span> <span class="n">found</span>
<span class="c1">#include &quot;numpy/arrayobject.h&quot;</span>
         <span class="o">^~~~~~~~~~~~~~~~~~~~~</span>
<span class="mi">1</span> <span class="n">error</span> <span class="n">generated</span><span class="o">.</span>
</pre></div>
</div>
<p>could be solved by <em>include_dirs</em> in <em>Extension</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">include_dirs</span><span class="o">=</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">get_include</span><span class="p">()],</span>
</pre></div>
</div>
<p>in setup.py</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">setup</span><span class="p">(</span>
    <span class="n">ext_modules</span><span class="o">=</span><span class="n">cythonize</span><span class="p">(</span><span class="n">Extension</span><span class="p">(</span><span class="s2">&quot;rect&quot;</span><span class="p">,</span>
                                    <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rect.pyx&quot;</span><span class="p">],</span>
                                    <span class="n">include_dirs</span><span class="o">=</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">get_include</span><span class="p">()],</span>
                                    <span class="n">language</span><span class="o">=</span><span class="s2">&quot;c++&quot;</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Notice: Please double check the spelling of <strong>include_dirs</strong>.
If you misspell it, there will be only a not highlight warning before fatal error of <em>‘numpy/arrayobject.h’ file not found</em> and it is very easy to miss.
In this case the whole output looks like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">CONDA_ENV_PATH</span><span class="o">&gt;/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">setuptools</span><span class="o">/</span><span class="n">_distutils</span><span class="o">/</span><span class="n">dist</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">262</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">Unknown</span> <span class="n">distribution</span> <span class="n">option</span><span class="p">:</span> <span class="s1">&#39;TYPO_OF_include_dirs&#39;</span>
  <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="n">running</span> <span class="n">build_ext</span>
<span class="n">building</span> <span class="s1">&#39;&lt;EXTENSION&gt;&#39;</span> <span class="n">extension</span>
<span class="n">clang</span> <span class="o">...</span>
<span class="o">&lt;</span><span class="n">EXTENSION</span><span class="o">&gt;.</span><span class="n">cpp</span><span class="p">:</span><span class="mi">973</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span> <span class="n">fatal</span> <span class="n">error</span><span class="p">:</span> <span class="s1">&#39;numpy/arrayobject.h&#39;</span> <span class="n">file</span> <span class="ow">not</span> <span class="n">found</span>
<span class="c1">#include &quot;numpy/arrayobject.h&quot;</span>
         <span class="o">^~~~~~~~~~~~~~~~~~~~~</span>
<span class="mi">1</span> <span class="n">error</span> <span class="n">generated</span><span class="o">.</span>
<span class="n">error</span><span class="p">:</span> <span class="n">command</span> <span class="s1">&#39;/usr/bin/clang&#39;</span> <span class="n">failed</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">1</span>
</pre></div>
</div>
<section id="use-cdef">
<h3>Use cdef<a class="headerlink" href="#use-cdef" title="Permalink to this heading">¶</a></h3>
<p>If something both exist in C and python, C take privilege, ex, float is C float</p>
</section>
<section id="cython-file-names">
<h3>cython file names<a class="headerlink" href="#cython-file-names" title="Permalink to this heading">¶</a></h3>
<p>You don’t have to use .pyx , any .py files are ok for cython</p>
</section>
<section id="setup-py-ext-modules">
<h3>setup.py ext_modules<a class="headerlink" href="#setup-py-ext-modules" title="Permalink to this heading">¶</a></h3>
<p>You could compile multiple extensions by</p>
<p>cythonize([“.pyx”, “.pyx”])</p>
</section>
<section id="cython-annotation">
<h3>cython annotation<a class="headerlink" href="#cython-annotation" title="Permalink to this heading">¶</a></h3>
<p>cython -a .pyx</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ambush.html" class="btn btn-neutral float-left" title="ambush" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="packaging.html" class="btn btn-neutral float-right" title="Packaging: What, Why and How" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Ke Zhang.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<div class="footer">This page uses <a href="https://analytics.google.com/">
Google Analytics</a> to collect statistics. You can disable it by blocking
the JavaScript coming from www.google-analytics.com.
<script>
  (function() {
    var ga = document.createElement('script');
    ga.src = ('https:' == document.location.protocol ?
              'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    ga.setAttribute('async', 'true');
    document.documentElement.firstChild.appendChild(ga);
  })();
</script>
</div>


</body>
</html>