<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Virtual Rigid Kinematics &mdash; nullspace 0.post1+g37e4e5c documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/nbsphinx-code-cells.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=0706b58e"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Control Flow" href="../controlflow.html" />
    <link rel="prev" title="Install" href="../install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            nullspace
          </a>
              <div class="version">
                0.post1+g37e4e5c
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../philosophy.html">Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Install</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Virtual Rigid Kinematics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controlflow.html">Control Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robot_descriptor.html">A Example of Robot Descriptor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../error_update.html">Error Update</a></li>
<li class="toctree-l1"><a class="reference internal" href="../best_fit_plane.html">Best Fit Plane</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nullspace_basic.html">Nullspace Basic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/autodiff_svd.html">Automatic Differentiating(AD) of Singular Value Decomposition(SVD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualization.html">Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Source Code</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../autodiff_svd.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robot_builder.html">robotBuilder</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Robotics Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/quaternion.html">Quaternion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../angular_momentum_derivative.html">angular_momentum_derivative</a></li>
<li class="toctree-l1"><a class="reference internal" href="../composite_inertia.html">composite_inertia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dof_computation.html">DOF Computation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dynamic_consistent_inverse.html">Dynamic Consistent Inverse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eigen_chain_multiplication.html">Eigen Chain Multiplication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../eigen_matrix_practice.html">Eigen Matrix Practice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release-history.html">Release History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../min_versions.html">Minimum Version of Python and NumPy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">nullspace</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Virtual Rigid Kinematics</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/virtual_rigid_kinematics.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Virtual-Rigid-Kinematics">
<h1>Virtual Rigid Kinematics<a class="headerlink" href="#Virtual-Rigid-Kinematics" title="Permalink to this heading">Â¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">%pip install nullspace</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;\n%pip install nullspace\n&#39;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">eye</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">simplify</span><span class="p">,</span> <span class="n">nsimplify</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">Array</span><span class="p">,</span> <span class="n">Matrix</span><span class="p">,</span> <span class="n">ZeroMatrix</span><span class="p">,</span> <span class="n">BlockMatrix</span>

<span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">nullspace.rbda</span> <span class="kn">import</span> <span class="n">Rx</span><span class="p">,</span> <span class="n">Ry</span><span class="p">,</span> <span class="n">Rz</span>
<span class="kn">from</span> <span class="nn">nullspace.se3</span> <span class="kn">import</span> <span class="n">hat</span><span class="p">,</span> <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span><span class="p">,</span> <span class="n">SXForm</span><span class="p">,</span> <span class="n">getE</span><span class="p">,</span> <span class="n">getr</span><span class="p">,</span> <span class="n">perfect_Ez_pi</span>
<span class="kn">from</span> <span class="nn">nullspace</span> <span class="kn">import</span> <span class="n">ensure_positive_Z</span><span class="p">,</span> <span class="n">autodiff_svd</span><span class="p">,</span> <span class="n">svd_regulated</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nullspace.models.structure</span> <span class="kn">import</span> <span class="n">q_sym</span>
<span class="kn">from</span> <span class="nn">nullspace.models.structure</span> <span class="kn">import</span> <span class="n">robotBuilder</span>

<span class="n">o</span> <span class="o">=</span> <span class="n">robotBuilder</span><span class="p">(</span><span class="s1">&#39;structure.yaml&#39;</span><span class="p">)</span>
<span class="n">abad0</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">abad1</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">abad2</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">abad3</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="n">hip0</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">hip1</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">hip2</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">hip3</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

<span class="n">knee0</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">knee1</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">knee2</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">knee3</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

<span class="n">foot0</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
<span class="n">foot1</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
<span class="n">foot2</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
<span class="n">foot3</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Control variables</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Top view of distance vectors.</span>
<span class="sd">        v3</span>
<span class="sd">    1&lt;-------0</span>
<span class="sd">    |\      /|</span>
<span class="sd">    | \  v2/ |</span>
<span class="sd">    |  \  /  |</span>
<span class="sd">    |   \/   |</span>
<span class="sd">  v1|   /\   |v4</span>
<span class="sd">    |  /  \  |</span>
<span class="sd">    | /  v0\ |</span>
<span class="sd">    vv      vv</span>
<span class="sd">    3&lt;-------2</span>
<span class="sd">        v5</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">v0</span> <span class="o">=</span> <span class="n">foot2</span> <span class="o">-</span> <span class="n">foot1</span>
<span class="n">v1</span> <span class="o">=</span> <span class="n">foot3</span> <span class="o">-</span> <span class="n">foot1</span>
<span class="n">v2</span> <span class="o">=</span> <span class="n">foot3</span> <span class="o">-</span> <span class="n">foot0</span>
<span class="n">v3</span> <span class="o">=</span> <span class="n">foot1</span> <span class="o">-</span> <span class="n">foot0</span>
<span class="n">v4</span> <span class="o">=</span> <span class="n">foot2</span> <span class="o">-</span> <span class="n">foot0</span>
<span class="n">v5</span> <span class="o">=</span> <span class="n">foot3</span> <span class="o">-</span> <span class="n">foot2</span>

<span class="c1"># 6 distances between each foots</span>
<span class="n">s0</span> <span class="o">=</span> <span class="n">v0</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">*</span> <span class="n">v0</span>
<span class="n">s1</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">*</span> <span class="n">v1</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">v2</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">*</span> <span class="n">v2</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">v3</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">*</span> <span class="n">v3</span>
<span class="n">s4</span> <span class="o">=</span> <span class="n">v4</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">*</span> <span class="n">v4</span>
<span class="n">s5</span> <span class="o">=</span> <span class="n">v5</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="o">*</span> <span class="n">v5</span>

<span class="n">dist</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">s4</span><span class="p">,</span> <span class="n">s5</span><span class="p">])</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">v5</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
<span class="n">cen</span> <span class="o">=</span> <span class="p">(</span><span class="n">foot0</span> <span class="o">+</span> <span class="n">foot1</span> <span class="o">+</span> <span class="n">foot2</span> <span class="o">+</span> <span class="n">foot3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">foot0</span> <span class="o">-</span> <span class="n">cen</span><span class="p">,</span> <span class="n">foot1</span> <span class="o">-</span> <span class="n">cen</span><span class="p">,</span> <span class="n">foot2</span> <span class="o">-</span> <span class="n">cen</span><span class="p">,</span> <span class="n">foot3</span> <span class="o">-</span> <span class="n">cen</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="n">var</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">q_sym</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Jacobian of control variables</span>

<span class="n">jc</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

<span class="c1"># For support_normal_option = &#39;cross&#39;</span>
<span class="n">j_ori</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">([</span><span class="n">n</span><span class="p">,</span> <span class="n">v5</span><span class="p">])</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
<span class="c1"># This format matches the frist two columns of normalized orthogonal basis of orientation.</span>
<span class="c1"># The 3rd/last column isn&#39;t needed here since there are only 6 independent vars and other</span>
<span class="c1"># 3 could be derived.</span>

<span class="c1"># For support_normal_option = &#39;svd&#39;</span>
<span class="n">j_ori_tail3</span> <span class="o">=</span> <span class="n">v5</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
<span class="c1"># j_ori_head3 will be achieved by autodiff_svd directly at specific q_star,</span>
<span class="c1"># there isn&#39;t analytical jacobian expression for derivative of normal vector if</span>
<span class="c1"># normal vector is calculated by best fitting from SVD.</span>

<span class="n">j_pos</span> <span class="o">=</span> <span class="n">cen</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

<span class="c1">#jc = jc.subs(links_params)</span>
<span class="c1">#j_ori = j_ori.subs(links_params)</span>
<span class="c1">#j_pos = j_pos.subs(links_params)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># FourLegRobot and ThreeLinkArm</span>


<span class="o">%</span><span class="k">matplotlib</span> notebook
<span class="o">%</span><span class="k">matplotlib</span> notebook
<span class="c1"># DON&#39;T DELETE, This isn&#39;t redundant in my knowledge of 2020</span>


<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">pi</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">mpl_toolkits.mplot3d.art3d</span> <span class="k">as</span> <span class="nn">art3d</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d.art3d</span> <span class="kn">import</span> <span class="n">Poly3DCollection</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">PathPatch</span><span class="p">,</span> <span class="n">Rectangle</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="kn">import</span> <span class="nn">time</span>




<span class="n">R_floor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="mf">0.8660254</span><span class="p">,</span>  <span class="mf">0.</span>       <span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span>      <span class="p">],</span>
                    <span class="p">[</span> <span class="mf">0.</span>       <span class="p">,</span>  <span class="mf">1.</span>       <span class="p">,</span>  <span class="mf">0.</span>       <span class="p">],</span>
                    <span class="p">[</span> <span class="mf">0.5</span>      <span class="p">,</span>  <span class="mf">0.</span>       <span class="p">,</span>  <span class="mf">0.8660254</span><span class="p">]])</span>
<span class="c1"># R_floor = Ry(-pi/6) @ Rx(pi/6)</span>
<span class="n">Pos_floor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">ThreeLinkArm</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joint_angles</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        joint_angles:</span>
<span class="sd">            The 3d vector of abad, hip and knee joint value.</span>

<span class="sd">        num:</span>
<span class="sd">            The number of iteration. This number is used to</span>
<span class="sd">            control the alpha of Arm plot.</span>

<span class="sd">        A, H, K and F: sympy objs</span>
<span class="sd">            Each of them could be thought as a mathematical</span>
<span class="sd">            function which takes 3 joints value and return</span>
<span class="sd">            abad, hip, knee and foot positions.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># ax is dependent injection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">A</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">=</span> <span class="n">H</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">K</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">F</span>


    <span class="k">def</span> <span class="nf">forward_kinematics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">q_sym</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">q_sym</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">q_sym</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angles</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">q_sym</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">q_sym</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">q_sym</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angles</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">q_sym</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">q_sym</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">q_sym</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angles</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="n">q_sym</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                 <span class="n">q_sym</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                 <span class="n">q_sym</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">joint_angles</span><span class="p">[</span><span class="mi">2</span><span class="p">]}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">d</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">knee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">d</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">foot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">d</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">abad_color</span><span class="p">,</span> <span class="n">hip_color</span><span class="p">,</span> <span class="n">knee_color</span><span class="p">):</span>

        <span class="c1"># plot one leg. index 0, 1 and 2 are meaning x, y, z composite here</span>
        <span class="c1"># plot abad - hip arm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">abad</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">hip</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">abad</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">hip</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">abad</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">hip</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                          <span class="n">color</span> <span class="o">=</span> <span class="n">abad_color</span><span class="p">)</span>

        <span class="c1"># plot hip - knee</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">hip</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">knee</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hip</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">knee</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hip</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">knee</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                          <span class="n">color</span> <span class="o">=</span> <span class="n">hip_color</span><span class="p">)</span>

        <span class="c1"># plot knee - foot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">knee</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">knee</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">knee</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                          <span class="n">color</span> <span class="o">=</span> <span class="n">knee_color</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">FourLegRobot</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">zeroth</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">third</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">support_normal_option</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">it</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Ori</span>
        <span class="c1"># Support and Body</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">support_normal_option</span> <span class="o">=</span> <span class="n">support_normal_option</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EdgeY_SupportOnBody_Target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EdgeY_SupportOnBody_Current</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Normal_SupportOnBody_Target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Normal_SupportOnBody_Current</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Current</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_BodyOnSupport_Target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_BodyOnSupport_Current</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnHorizon_Current</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># R0, Estimation of Floor Ori</span>

        <span class="c1"># Body and Horizon</span>
        <span class="c1"># This is INPUT target of ori which in Horioin Coordinate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_BodyOnHorizon_Target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_BodyOnHorizon_Current</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IMU_BodyOnHorizon_Sim</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># A alias of self.Ori_BodyOnHorizon_Current</span>

        <span class="c1"># Pos</span>
        <span class="c1"># This is INPUT target of pos which is calibrated to Horizontal Support Coordinate</span>
        <span class="c1"># to make it match human visual feelings and dynamics.</span>
        <span class="c1"># This is HorizontalSupport not Horizon since we don&#39;t no/don&#39;t need to know</span>
        <span class="c1"># where the robot is. It might be on Everest or someone&#39;s home.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pos_BodyOnHorizontalSupport_Target</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Pos_BodyOnSupport_Target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportOnBody_Target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportCentroidOnBody_Current</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportOnBody_Error</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">zeroth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">second</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">third</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">support_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizon_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

        <span class="n">start_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">abad</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">abad</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">abad</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="n">start_point</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">body_length</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">body_width</span><span class="p">,</span>
                        <span class="n">angle</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span>
                        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="c1"># r: Base body which is simplified to a rectangle</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
        <span class="n">art3d</span><span class="o">.</span><span class="n">pathpatch_2d_to_3d</span><span class="p">(</span><span class="n">rec</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">support_ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">support_ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">support_ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">horizon_ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizon_ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizon_ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>


        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;auto&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">body_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">body_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">body_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">body_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span>



    <span class="k">def</span> <span class="nf">set_Ori_BodyOnSupport_Target_byRotation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set Ori by Rotation matrix of Body relative to support area.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_BodyOnSupport_Target</span> <span class="o">=</span> <span class="n">R</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ori_BodyOnSupport_Target</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Normal_SupportOnBody_Target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Target</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EdgeY_SupportOnBody_Target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Target</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set_Ori_BodyOnSupport_byYZ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yz</span><span class="p">):</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="n">yz</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">yz</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="n">col1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">col1</span><span class="p">)</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="n">col2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">col2</span><span class="p">)</span>
        <span class="n">col0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">col0</span><span class="p">,</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_Ori_BodyOnSupport_Target_byRotation</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_Ori_BodyOnSupport_Target_byRPY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">yaw</span><span class="p">):</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">Rz</span><span class="p">(</span><span class="n">yaw</span><span class="p">)</span> <span class="o">@</span> <span class="n">Ry</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span> <span class="o">@</span> <span class="n">Rx</span><span class="p">(</span><span class="n">roll</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_Ori_BodyOnSupport_Target_byRotation</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_Ori_BodyOnHorizon_Target_byRPY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">roll</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">yaw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_BodyOnHorizon_Target</span> <span class="o">=</span> <span class="n">Rz</span><span class="p">(</span><span class="n">yaw</span><span class="p">)</span> <span class="o">@</span> <span class="n">Ry</span><span class="p">(</span><span class="n">pitch</span><span class="p">)</span> <span class="o">@</span> <span class="n">Rx</span><span class="p">(</span><span class="n">roll</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_Pos_SupportOnBody_Target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Pos_BodyOnSupport_Target</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportOnBody_Target</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Target</span>
                                          <span class="o">@</span> <span class="n">Pos_BodyOnSupport_Target</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_Ori_SupportOnBody_Current</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edgeY</span><span class="p">,</span> <span class="n">normal</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">edgeY</span><span class="p">,</span> <span class="n">normal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">edgeY</span><span class="p">,</span> <span class="n">normal</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_edgeY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Top View</span>

<span class="sd">        1 --- 0</span>
<span class="sd">        |     |</span>
<span class="sd">        |     |</span>
<span class="sd">        |     |</span>
<span class="sd">        3 --- 2</span>

<span class="sd">        Get the edge vector along Y-ish direction inside the best-fit plane.</span>

<span class="sd">        The edge vector start point is the projection point of middle point</span>
<span class="sd">        between foot 0 and foot 2 on best-fit plane.</span>
<span class="sd">        The edge vector end point is the projection point of middle point</span>
<span class="sd">        between foot 1 and foot 3 on best-fit plane.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        vec : np.array</span>
<span class="sd">            edgeY-ish vector</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">support_normal_option</span> <span class="o">==</span> <span class="s1">&#39;svd&#39;</span><span class="p">:</span>
            <span class="n">middle_point_bt13</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">mp13_projection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point_projection_on_plane</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportCentroidOnBody_Current</span><span class="p">,</span>
                                                                 <span class="bp">self</span><span class="o">.</span><span class="n">Normal_SupportOnBody_Current</span><span class="p">,</span>
                                                                 <span class="n">middle_point_bt13</span><span class="p">)</span>

            <span class="n">middle_point_bt02</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">mp02_projection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point_projection_on_plane</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportCentroidOnBody_Current</span><span class="p">,</span>
                                                                 <span class="bp">self</span><span class="o">.</span><span class="n">Normal_SupportOnBody_Current</span><span class="p">,</span>
                                                                 <span class="n">middle_point_bt02</span><span class="p">)</span>
            <span class="n">vec</span> <span class="o">=</span> <span class="n">mp13_projection</span> <span class="o">-</span> <span class="n">mp02_projection</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span>
        <span class="k">return</span> <span class="n">vec</span>

    <span class="k">def</span> <span class="nf">get_point_projection_on_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate the point coordinate on certain plane.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        c : numpy array</span>
<span class="sd">            Plane is discribed by a point and normal vector.</span>
<span class="sd">            c is the point of this discription.</span>
<span class="sd">        n : numpy array</span>
<span class="sd">            Plane is discribed by a point and normal vector.</span>
<span class="sd">            n is the normal vector of this discription.</span>
<span class="sd">        p : numpy array</span>
<span class="sd">            The target point in space that need to be projected</span>
<span class="sd">            on plane.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        res : numpy array</span>
<span class="sd">            Point coordinate on plane.</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">t</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
        <span class="c1"># * is element-wise here.</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="n">n</span>
        <span class="k">return</span> <span class="n">res</span>


    <span class="k">def</span> <span class="nf">update_joints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q_values</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">joint_angles</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">joint_angles</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">joint_angles</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">joint_angles</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">forward_kinematics</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">forward_kinematics</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">forward_kinematics</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">forward_kinematics</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">prepare_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">progress</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">it</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">base_color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.8</span> <span class="o">-</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span>
                           <span class="mf">0.8</span> <span class="o">-</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span>
                           <span class="mf">0.8</span> <span class="o">-</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span>
                           <span class="mf">0.7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">abad_color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.8</span> <span class="o">-</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span>
                           <span class="mf">0.8</span> <span class="o">-</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span>
                           <span class="mf">0.8</span> <span class="o">-</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span>
                           <span class="mf">0.7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hip_color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.7</span> <span class="o">-</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span>
                          <span class="mf">0.8</span> <span class="o">-</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span>
                          <span class="mf">0.9</span> <span class="o">-</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span>
                          <span class="mf">0.7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">knee_color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.9</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span>
                           <span class="mf">0.8</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span>
                           <span class="mf">0.7</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">progress</span><span class="p">,</span>
                           <span class="mf">0.7</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">it</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">support_color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.745</span><span class="p">,</span> <span class="mf">0.458</span><span class="p">,</span> <span class="mf">0.941</span><span class="p">)</span> <span class="c1"># Purple</span>
    <span class="k">def</span> <span class="nf">plot_on_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Plot each arms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">it</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abad_color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hip_color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">knee_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">it</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abad_color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hip_color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">knee_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">it</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abad_color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hip_color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">knee_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">it</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">abad_color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hip_color</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">knee_color</span><span class="p">)</span>

        <span class="c1"># Plot quadrilateral supporting area in purple color(&quot;0.745, 0.458, 0.941&quot;)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                          <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">support_color</span><span class="p">,</span>
                          <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                          <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">support_color</span><span class="p">,</span>
                          <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                          <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">support_color</span><span class="p">,</span>
                          <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">body_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                          <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                          <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">support_color</span><span class="p">,</span>
                          <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">plot_on_support_each_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate each joints location of one leg under horizon coordinate.</span>
<span class="sd">        There are 4 joints and 3 links.</span>
<span class="sd">        The location of abad joint is identical with node location on base body.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportCentroidOnBody_Current</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Current</span>

        <span class="n">abad_on_support</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">abad</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>
        <span class="n">hip_on_support</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">hip</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>
        <span class="n">knee_on_support</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">knee</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>
        <span class="n">foot_on_support</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">foot</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">support_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">abad_on_support</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hip_on_support</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">abad_on_support</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hip_on_support</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">abad_on_support</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">hip_on_support</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">abad_color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">support_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">hip_on_support</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">knee_on_support</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">hip_on_support</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">knee_on_support</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">hip_on_support</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">knee_on_support</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hip_color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">support_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">knee_on_support</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">foot_on_support</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">knee_on_support</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">foot_on_support</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">knee_on_support</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">foot_on_support</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">knee_color</span><span class="p">)</span>



    <span class="k">def</span> <span class="nf">plot_on_support</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot on support area coordinate with Centroid as origin.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportCentroidOnBody_Current</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Current</span>

        <span class="c1"># Calculate base body rectangle, 4 nodes, location on support coordinate</span>
        <span class="n">s0</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abad</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>
        <span class="n">s1</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">abad</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">abad</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">abad</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span>

        <span class="c1"># Plot base body on support_ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">support_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">s0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">s0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s1</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">s0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">s1</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">support_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">s0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">s0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">s0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">s2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">support_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">s3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">s3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s1</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">s3</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">s1</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">support_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">s3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">s3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">s3</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">s2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_color</span><span class="p">)</span>

        <span class="c1"># Plot 4 legs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_on_support_each_arm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">plot_on_horizon_each_arm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arm</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate each joints location of one leg under horizon coordinate.</span>
<span class="sd">        There are 4 joints and 3 links.</span>
<span class="sd">        The location of abad joint is identical with node location on base body.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportCentroidOnBody_Current</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Current</span>


        <span class="n">abad_on_horizon</span> <span class="o">=</span> <span class="n">R_floor</span> <span class="o">@</span> <span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">abad</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pos_floor</span><span class="p">)</span>
        <span class="n">hip_on_horizon</span> <span class="o">=</span> <span class="n">R_floor</span> <span class="o">@</span> <span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">hip</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pos_floor</span><span class="p">)</span>
        <span class="n">knee_on_horizon</span> <span class="o">=</span> <span class="n">R_floor</span> <span class="o">@</span> <span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">knee</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pos_floor</span><span class="p">)</span>
        <span class="n">foot_on_horizon</span> <span class="o">=</span> <span class="n">R_floor</span> <span class="o">@</span> <span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">arm</span><span class="o">.</span><span class="n">foot</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pos_floor</span><span class="p">)</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">horizon_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">abad_on_horizon</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hip_on_horizon</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">abad_on_horizon</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hip_on_horizon</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">abad_on_horizon</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">hip_on_horizon</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">abad_color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">horizon_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">hip_on_horizon</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">knee_on_horizon</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">hip_on_horizon</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">knee_on_horizon</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">hip_on_horizon</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">knee_on_horizon</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hip_color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">horizon_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">knee_on_horizon</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">foot_on_horizon</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">knee_on_horizon</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">foot_on_horizon</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">knee_on_horizon</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">foot_on_horizon</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">knee_color</span><span class="p">)</span>

        <span class="c1"># Plot a circle as representing floor contact area/point.</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        if self.it == 0:</span>
<span class="sd">            cir = Circle((foot_on_horizon[0], foot_on_horizon[1]),</span>
<span class="sd">                         radius=0.05,</span>
<span class="sd">                         color=(0.1, 0.1, 0.1),</span>
<span class="sd">                         alpha=0.5)</span>
<span class="sd">            self.horizon_ax.add_patch(cir)</span>
<span class="sd">            art3d.pathpatch_2d_to_3d(cir, z=foot_on_horizon[2], zdir=&quot;z&quot;)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="n">foot_on_horizon</span>

    <span class="k">def</span> <span class="nf">plot_on_horizon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Plot on horizon coordinate</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportCentroidOnBody_Current</span>
        <span class="n">R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Current</span>

        <span class="c1"># Calculate base body rectangle, 4 nodes, location on support coordinate.</span>
        <span class="n">h0</span> <span class="o">=</span> <span class="n">R_floor</span> <span class="o">@</span> <span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">abad</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pos_floor</span><span class="p">)</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="n">R_floor</span> <span class="o">@</span> <span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">abad</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pos_floor</span><span class="p">)</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">R_floor</span> <span class="o">@</span> <span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">abad</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pos_floor</span><span class="p">)</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="n">R_floor</span> <span class="o">@</span> <span class="p">(</span><span class="n">R</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">abad</span> <span class="o">-</span> <span class="n">pos</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pos_floor</span><span class="p">)</span>



        <span class="c1"># Plot base body on horizon_ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">horizon_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">h0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">h0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">h1</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">h0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">h1</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">horizon_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">h0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">h0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">h2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">h0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">h2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">horizon_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">h3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">h3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">h1</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">h3</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">h1</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">horizon_ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">h3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">h2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">h3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">h2</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                             <span class="p">[</span><span class="n">h3</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">h2</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                             <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">base_color</span><span class="p">)</span>

        <span class="c1"># Plot 4 legs</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">verts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_on_horizon_each_arm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c1"># self.horizon_ax.plot(*((h0 + h1 + h2 + h3)/4), marker=&#39;.&#39;, color = &#39;k&#39;)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">it</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">triangles</span> <span class="o">=</span> <span class="p">[[</span><span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">verts</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                         <span class="p">[</span><span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">verts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                         <span class="p">[</span><span class="n">verts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                         <span class="p">[</span><span class="n">verts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">verts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">verts</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">horizon_ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">Poly3DCollection</span><span class="p">(</span><span class="n">triangles</span><span class="p">,</span>
                                                            <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
                                                            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
                                                            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">))</span>
    <span class="c1"># Update Error</span>
    <span class="k">def</span> <span class="nf">update_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Estimator</span>
        <span class="c1"># Normal</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">support_normal_option</span> <span class="o">==</span> <span class="s1">&#39;svd&#39;</span><span class="p">:</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="n">svd_regulated</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">q_star</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">))[</span><span class="mi">0</span><span class="p">][:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># This normal is normalized already</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Normal_SupportOnBody_Current</span> <span class="o">=</span> <span class="n">normal</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Normal_SupportOnBody_Current</span> <span class="o">=</span> <span class="n">normal</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span>

        <span class="c1"># Centroid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportCentroidOnBody_Current</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">arms</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">foot</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span>

        <span class="c1"># EdgeY</span>
        <span class="n">edgeY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_edgeY</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EdgeY_SupportOnBody_Current</span> <span class="o">=</span> <span class="n">edgeY</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">edgeY</span><span class="p">)</span>

        <span class="c1"># After Ori Estimator, Ori prepare</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_Ori_SupportOnBody_Current</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EdgeY_SupportOnBody_Current</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Normal_SupportOnBody_Current</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_BodyOnSupport_Current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Current</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># This need to be updated with real IMU, maybe from 4 points of body rectangle.</span>
        <span class="c1"># Maybe not need to be updated, since 4 points of body rectangles need to be</span>
        <span class="c1"># calculated by god view which need R_floor. Maybe use R_floor directly is just fine.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IMU_BodyOnHorizon_Sim</span> <span class="o">=</span> <span class="n">R_floor</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Current</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_BodyOnHorizon_Current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IMU_BodyOnHorizon_Sim</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnHorizon_Current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ori_BodyOnHorizon_Current</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ori_BodyOnSupport_Current</span><span class="o">.</span><span class="n">T</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compare&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnHorizon_Current</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">R_floor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_Ori_BodyOnSupport_Target_byRotation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnHorizon_Current</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ori_BodyOnHorizon_Target</span><span class="p">)</span>

        <span class="c1"># Pos prepare</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pos_BodyOnSupport_Target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnHorizon_Current</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pos_BodyOnHorizontalSupport_Target</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos_BodyOnSupport_Target: &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pos_BodyOnSupport_Target</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_Pos_SupportOnBody_Target</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Pos_BodyOnSupport_Target</span><span class="p">)</span> <span class="c1"># SE(3) conversion</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Error</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Normal_SupportOnBody_Target</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Normal_SupportOnBody_Current</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Error</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span> <span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">EdgeY_SupportOnBody_Target</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">EdgeY_SupportOnBody_Current</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportOnBody_Error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportOnBody_Target</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Pos_SupportCentroidOnBody_Current</span>
        <span class="c1"># Pos_SupportOnBody_Error = np.array([0.01, 0, 0])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Whole control Figure</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Top View</span>

<span class="sd">    1 --- 0</span>
<span class="sd">    |     |</span>
<span class="sd">    |     |</span>
<span class="sd">    |     |</span>
<span class="sd">    3 --- 2</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="o">%</span><span class="k">matplotlib</span> notebook
<span class="o">%</span><span class="k">matplotlib</span> notebook
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="c1"># The iter number</span>
<span class="n">num</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1"># The init value of joints, q0 - q11</span>

<span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pi</span><span class="o">/</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="o">/</span><span class="mi">5</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span>
               <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span>
              <span class="n">pi</span><span class="o">/</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span>
               <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="o">/</span><span class="mi">5</span><span class="o">*</span><span class="n">pi</span><span class="p">])</span>



<span class="n">robot</span> <span class="o">=</span> <span class="n">FourLegRobot</span><span class="p">(</span><span class="n">ThreeLinkArm</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">num</span><span class="p">,</span> <span class="n">abad0</span><span class="p">,</span> <span class="n">hip0</span><span class="p">,</span> <span class="n">knee0</span><span class="p">,</span> <span class="n">foot0</span><span class="p">),</span>
                     <span class="n">ThreeLinkArm</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">num</span><span class="p">,</span> <span class="n">abad1</span><span class="p">,</span> <span class="n">hip1</span><span class="p">,</span> <span class="n">knee1</span><span class="p">,</span> <span class="n">foot1</span><span class="p">),</span>
                     <span class="n">ThreeLinkArm</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">],</span> <span class="n">num</span><span class="p">,</span> <span class="n">abad2</span><span class="p">,</span> <span class="n">hip2</span><span class="p">,</span> <span class="n">knee2</span><span class="p">,</span> <span class="n">foot2</span><span class="p">),</span>
                     <span class="n">ThreeLinkArm</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">12</span><span class="p">],</span> <span class="n">num</span><span class="p">,</span> <span class="n">abad3</span><span class="p">,</span> <span class="n">hip3</span><span class="p">,</span> <span class="n">knee3</span><span class="p">,</span> <span class="n">foot3</span><span class="p">),</span>
                     <span class="n">num</span><span class="p">,</span> <span class="n">support_normal_option</span> <span class="o">=</span> <span class="s1">&#39;svd&#39;</span><span class="p">)</span>



<span class="c1"># Ori task: normalized and orthogonal orientation of support area relative to base body</span>
<span class="c1"># Below matches</span>
<span class="c1"># R =  Ry(-pi/6) @ Rx(pi/12)</span>
<span class="c1"># Y_BodyOnSupport_Target = R[:, 1]</span>
<span class="c1"># Z_BodyOnSupport_Target = R[:, 2]</span>

<span class="c1"># YZ_BodyOnSupport_Target = np.array([-0.12940952, 0.96592583, 0.22414387, -0.48296291, -0.25881905, 0.8365163])</span>
<span class="c1"># robot.set_Ori_BodyOnSupport_byYZ(YZ_BodyOnSupport_Target)</span>

<span class="c1"># robot.set_Ori_BodyOnSupport_Target_byRPY(0, pi/6, 0)</span>
<span class="n">robot</span><span class="o">.</span><span class="n">set_Ori_BodyOnHorizon_Target_byRPY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>




<span class="c1"># Pos task: 3d vector of middle point of foot position relative to base body</span>
<span class="n">robot</span><span class="o">.</span><span class="n">Pos_BodyOnHorizontalSupport_Target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">])</span>



<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;i: &#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">robot</span><span class="o">.</span><span class="n">it</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">robot</span><span class="o">.</span><span class="n">update_joints</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="c1"># Check distance</span>
    <span class="c1"># q_star = {q0: q[0], q1: q[1], q2: q[2], q3: q[3], q4: q[4], q5: q[5], q6: q[6], q7: q[7], q8: q[8], q9: q[9], q10: q[10], q11: q[11]}</span>
    <span class="n">q_star</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">q_sym</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s0</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">q_star</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">q_star</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">q_star</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s3</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">q_star</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s4</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">q_star</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s5</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">q_star</span><span class="p">))</span>


    <span class="n">robot</span><span class="o">.</span><span class="n">update_error</span><span class="p">()</span>


    <span class="c1"># PLOT</span>
    <span class="n">robot</span><span class="o">.</span><span class="n">prepare_plot</span><span class="p">()</span>
    <span class="n">robot</span><span class="o">.</span><span class="n">plot_on_body</span><span class="p">()</span>
    <span class="n">robot</span><span class="o">.</span><span class="n">plot_on_support</span><span class="p">()</span>
    <span class="n">robot</span><span class="o">.</span><span class="n">plot_on_horizon</span><span class="p">()</span>

    <span class="c1"># NULLSPACE CONTROLLER</span>
    <span class="c1"># Contact Task</span>
    <span class="c1"># Sustitute symbolic expression with actual joint value</span>
    <span class="n">jc_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">jc</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">q_star</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="c1"># Ori Task</span>
    <span class="c1"># Calcualte Null space of contact jacobian</span>
    <span class="n">Nc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">jc_np</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">)</span> <span class="o">@</span> <span class="n">jc_np</span>
    <span class="c1"># Calcualte j_pre for ori task which is in null space of contact jacobian</span>


    <span class="k">if</span> <span class="n">robot</span><span class="o">.</span><span class="n">support_normal_option</span> <span class="o">==</span> <span class="s1">&#39;svd&#39;</span><span class="p">:</span>
        <span class="n">j_ori_tail3_num</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">j_ori_tail3</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">q_star</span><span class="p">),</span> <span class="n">dtype</span> <span class="o">=</span> <span class="nb">float</span><span class="p">)</span>
        <span class="c1"># NOTICE!</span>
        <span class="c1"># This is the jacobian of v5 or edgeY, NOT the jacobian of normalized v5.</span>
        <span class="c1"># However, this jacobian of v5 still ensure we will go along correct direction.</span>
        <span class="n">dU</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">autodiff_svd</span><span class="p">(</span><span class="n">A</span> <span class="p">,</span><span class="n">q_star</span><span class="p">)</span>
        <span class="n">j_ori_head3_num</span> <span class="o">=</span> <span class="n">dU</span><span class="p">[:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">j_pre</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">j_ori_head3_num</span><span class="p">,</span> <span class="n">j_ori_tail3_num</span><span class="p">))</span> <span class="o">@</span> <span class="n">Nc</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># support_normal_option = &#39;cross&#39;</span>
        <span class="n">j_pre</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">j_ori</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">q_star</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="o">@</span> <span class="n">Nc</span>


    <span class="c1"># Pos Task</span>
    <span class="c1"># Calculate Null space of both ori and contact task.</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">j_pre</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">)</span> <span class="o">@</span> <span class="n">j_pre</span>
    <span class="c1"># Calculate j_pre2 for pos task which is in null space of both contact jacobian and ori</span>
    <span class="n">j_pre2</span> <span class="o">=</span> <span class="n">j_pos</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">q_star</span><span class="p">)</span> <span class="o">@</span> <span class="n">Nc</span> <span class="o">@</span> <span class="n">N</span>
    <span class="n">j_pre2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">j_pre2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>


    <span class="c1"># Calculate delta q for ori task</span>
    <span class="n">dq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">j_pre</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">)</span> <span class="o">@</span> <span class="n">robot</span><span class="o">.</span><span class="n">Ori_SupportOnBody_Error</span>

    <span class="c1"># Calculate delta q for pos task</span>
    <span class="n">dq2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">j_pre2</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">)</span> <span class="o">@</span> <span class="n">robot</span><span class="o">.</span><span class="n">Pos_SupportOnBody_Error</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    print(&quot;Ori Pre NUll space checking&quot;)</span>
<span class="sd">    print(np.isclose(jc_np * np.linalg.pinv(j_pre, rcond=1e-9), np.zeros((1, 3))))</span>
<span class="sd">    print(&quot;Pos Pre Null space checking&quot;)</span>
<span class="sd">    print(np.isclose(j_pre * np.linalg.pinv(j_pre2, rcond=1e-9), np.zeros((3, 3))))</span>
<span class="sd">    print()</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Update q. As error decrease, make Kp become bigger and bigger to coverge</span>
    <span class="c1"># faster.</span>

    <span class="c1"># The reason why there are 2 seperated Kp: The jacobian of support</span>
    <span class="c1"># normal vector(head 3 of j_ori) achieved by svd method is for normalized</span>
    <span class="c1"># support normal vector(U[:, -1]) while the jacobian of support normal</span>
    <span class="c1"># vector (head 3 of j_ori) achieved by cross method is for raw normal</span>
    <span class="c1"># vector(cross result). So, the scale need to be adjusted.</span>

    <span class="c1"># If we wanna united 2 Kp, a possible approach might be updating &#39;svd&#39;</span>
    <span class="c1"># method so that the normal jacobian(head 3 of j_ori) isn&#39;t for normalized</span>
    <span class="c1"># normal vector. It&#39;s just use U[:, -1] * S(Sigular value array, the middle</span>
    <span class="c1"># result, of standard SVD) instead of normalized U[:, -1].</span>

    <span class="c1"># Since the svd method is more precise than other methods. If the calculating</span>
    <span class="c1"># power allow, this program should use svd method as much as possible.</span>

    <span class="c1"># Also notice, the tail 3 of j_ori isn&#39;t for normalized edgeY vector in</span>
    <span class="c1"># both &#39;svd&#39; and &#39;cross&#39; method. It&#39;s for raw edgeY vector.</span>
    <span class="k">if</span> <span class="n">robot</span><span class="o">.</span><span class="n">support_normal_option</span> <span class="o">==</span> <span class="s1">&#39;svd&#39;</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span> <span class="o">+</span> <span class="mf">0.9</span> <span class="o">/</span> <span class="n">num</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dq</span> <span class="o">+</span> <span class="mf">0.9</span> <span class="o">/</span> <span class="n">num</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dq2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">/</span> <span class="n">num</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dq</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">/</span> <span class="n">num</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dq2</span>

    <span class="c1"># q = q + dq/max(dq)*0.01 + dq2/max(dq2) *0.01</span>
    <span class="c1"># q = q + dq + dq2</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;
/* Put everything inside the global mpl namespace */
/* global mpl */
window.mpl = {};

mpl.get_websocket_type = function () {
    if (typeof WebSocket !== 'undefined') {
        return WebSocket;
    } else if (typeof MozWebSocket !== 'undefined') {
        return MozWebSocket;
    } else {
        alert(
            'Your browser does not have WebSocket support. ' +
                'Please try Chrome, Safari or Firefox â¥ 6. ' +
                'Firefox 4 and 5 are also supported but you ' +
                'have to enable WebSockets in about:config.'
        );
    }
};

mpl.figure = function (figure_id, websocket, ondownload, parent_element) {
    this.id = figure_id;

    this.ws = websocket;

    this.supports_binary = this.ws.binaryType !== undefined;

    if (!this.supports_binary) {
        var warnings = document.getElementById('mpl-warnings');
        if (warnings) {
            warnings.style.display = 'block';
            warnings.textContent =
                'This browser does not support binary websocket messages. ' +
                'Performance may be slow.';
        }
    }

    this.imageObj = new Image();

    this.context = undefined;
    this.message = undefined;
    this.canvas = undefined;
    this.rubberband_canvas = undefined;
    this.rubberband_context = undefined;
    this.format_dropdown = undefined;

    this.image_mode = 'full';

    this.root = document.createElement('div');
    this.root.setAttribute('style', 'display: inline-block');
    this._root_extra_style(this.root);

    parent_element.appendChild(this.root);

    this._init_header(this);
    this._init_canvas(this);
    this._init_toolbar(this);

    var fig = this;

    this.waiting = false;

    this.ws.onopen = function () {
        fig.send_message('supports_binary', { value: fig.supports_binary });
        fig.send_message('send_image_mode', {});
        if (fig.ratio !== 1) {
            fig.send_message('set_device_pixel_ratio', {
                device_pixel_ratio: fig.ratio,
            });
        }
        fig.send_message('refresh', {});
    };

    this.imageObj.onload = function () {
        if (fig.image_mode === 'full') {
            // Full images could contain transparency (where diff images
            // almost always do), so we need to clear the canvas so that
            // there is no ghosting.
            fig.context.clearRect(0, 0, fig.canvas.width, fig.canvas.height);
        }
        fig.context.drawImage(fig.imageObj, 0, 0);
    };

    this.imageObj.onunload = function () {
        fig.ws.close();
    };

    this.ws.onmessage = this._make_on_message_function(this);

    this.ondownload = ondownload;
};

mpl.figure.prototype._init_header = function () {
    var titlebar = document.createElement('div');
    titlebar.classList =
        'ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix';
    var titletext = document.createElement('div');
    titletext.classList = 'ui-dialog-title';
    titletext.setAttribute(
        'style',
        'width: 100%; text-align: center; padding: 3px;'
    );
    titlebar.appendChild(titletext);
    this.root.appendChild(titlebar);
    this.header = titletext;
};

mpl.figure.prototype._canvas_extra_style = function (_canvas_div) {};

mpl.figure.prototype._root_extra_style = function (_canvas_div) {};

mpl.figure.prototype._init_canvas = function () {
    var fig = this;

    var canvas_div = (this.canvas_div = document.createElement('div'));
    canvas_div.setAttribute('tabindex', '0');
    canvas_div.setAttribute(
        'style',
        'border: 1px solid #ddd;' +
            'box-sizing: content-box;' +
            'clear: both;' +
            'min-height: 1px;' +
            'min-width: 1px;' +
            'outline: 0;' +
            'overflow: hidden;' +
            'position: relative;' +
            'resize: both;' +
            'z-index: 2;'
    );

    function on_keyboard_event_closure(name) {
        return function (event) {
            return fig.key_event(event, name);
        };
    }

    canvas_div.addEventListener(
        'keydown',
        on_keyboard_event_closure('key_press')
    );
    canvas_div.addEventListener(
        'keyup',
        on_keyboard_event_closure('key_release')
    );

    this._canvas_extra_style(canvas_div);
    this.root.appendChild(canvas_div);

    var canvas = (this.canvas = document.createElement('canvas'));
    canvas.classList.add('mpl-canvas');
    canvas.setAttribute(
        'style',
        'box-sizing: content-box;' +
            'pointer-events: none;' +
            'position: relative;' +
            'z-index: 0;'
    );

    this.context = canvas.getContext('2d');

    var backingStore =
        this.context.backingStorePixelRatio ||
        this.context.webkitBackingStorePixelRatio ||
        this.context.mozBackingStorePixelRatio ||
        this.context.msBackingStorePixelRatio ||
        this.context.oBackingStorePixelRatio ||
        this.context.backingStorePixelRatio ||
        1;

    this.ratio = (window.devicePixelRatio || 1) / backingStore;

    var rubberband_canvas = (this.rubberband_canvas = document.createElement(
        'canvas'
    ));
    rubberband_canvas.setAttribute(
        'style',
        'box-sizing: content-box;' +
            'left: 0;' +
            'pointer-events: none;' +
            'position: absolute;' +
            'top: 0;' +
            'z-index: 1;'
    );

    // Apply a ponyfill if ResizeObserver is not implemented by browser.
    if (this.ResizeObserver === undefined) {
        if (window.ResizeObserver !== undefined) {
            this.ResizeObserver = window.ResizeObserver;
        } else {
            var obs = _JSXTOOLS_RESIZE_OBSERVER({});
            this.ResizeObserver = obs.ResizeObserver;
        }
    }

    this.resizeObserverInstance = new this.ResizeObserver(function (entries) {
        var nentries = entries.length;
        for (var i = 0; i < nentries; i++) {
            var entry = entries[i];
            var width, height;
            if (entry.contentBoxSize) {
                if (entry.contentBoxSize instanceof Array) {
                    // Chrome 84 implements new version of spec.
                    width = entry.contentBoxSize[0].inlineSize;
                    height = entry.contentBoxSize[0].blockSize;
                } else {
                    // Firefox implements old version of spec.
                    width = entry.contentBoxSize.inlineSize;
                    height = entry.contentBoxSize.blockSize;
                }
            } else {
                // Chrome <84 implements even older version of spec.
                width = entry.contentRect.width;
                height = entry.contentRect.height;
            }

            // Keep the size of the canvas and rubber band canvas in sync with
            // the canvas container.
            if (entry.devicePixelContentBoxSize) {
                // Chrome 84 implements new version of spec.
                canvas.setAttribute(
                    'width',
                    entry.devicePixelContentBoxSize[0].inlineSize
                );
                canvas.setAttribute(
                    'height',
                    entry.devicePixelContentBoxSize[0].blockSize
                );
            } else {
                canvas.setAttribute('width', width * fig.ratio);
                canvas.setAttribute('height', height * fig.ratio);
            }
            /* This rescales the canvas back to display pixels, so that it
             * appears correct on HiDPI screens. */
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';

            rubberband_canvas.setAttribute('width', width);
            rubberband_canvas.setAttribute('height', height);

            // And update the size in Python. We ignore the initial 0/0 size
            // that occurs as the element is placed into the DOM, which should
            // otherwise not happen due to the minimum size styling.
            if (fig.ws.readyState == 1 && width != 0 && height != 0) {
                fig.request_resize(width, height);
            }
        }
    });
    this.resizeObserverInstance.observe(canvas_div);

    function on_mouse_event_closure(name) {
        /* User Agent sniffing is bad, but WebKit is busted:
         * https://bugs.webkit.org/show_bug.cgi?id=144526
         * https://bugs.webkit.org/show_bug.cgi?id=181818
         * The worst that happens here is that they get an extra browser
         * selection when dragging, if this check fails to catch them.
         */
        var UA = navigator.userAgent;
        var isWebKit = /AppleWebKit/.test(UA) && !/Chrome/.test(UA);
        if(isWebKit) {
            return function (event) {
                /* This prevents the web browser from automatically changing to
                 * the text insertion cursor when the button is pressed. We
                 * want to control all of the cursor setting manually through
                 * the 'cursor' event from matplotlib */
                event.preventDefault()
                return fig.mouse_event(event, name);
            };
        } else {
            return function (event) {
                return fig.mouse_event(event, name);
            };
        }
    }

    canvas_div.addEventListener(
        'mousedown',
        on_mouse_event_closure('button_press')
    );
    canvas_div.addEventListener(
        'mouseup',
        on_mouse_event_closure('button_release')
    );
    canvas_div.addEventListener(
        'dblclick',
        on_mouse_event_closure('dblclick')
    );
    // Throttle sequential mouse events to 1 every 20ms.
    canvas_div.addEventListener(
        'mousemove',
        on_mouse_event_closure('motion_notify')
    );

    canvas_div.addEventListener(
        'mouseenter',
        on_mouse_event_closure('figure_enter')
    );
    canvas_div.addEventListener(
        'mouseleave',
        on_mouse_event_closure('figure_leave')
    );

    canvas_div.addEventListener('wheel', function (event) {
        if (event.deltaY < 0) {
            event.step = 1;
        } else {
            event.step = -1;
        }
        on_mouse_event_closure('scroll')(event);
    });

    canvas_div.appendChild(canvas);
    canvas_div.appendChild(rubberband_canvas);

    this.rubberband_context = rubberband_canvas.getContext('2d');
    this.rubberband_context.strokeStyle = '#000000';

    this._resize_canvas = function (width, height, forward) {
        if (forward) {
            canvas_div.style.width = width + 'px';
            canvas_div.style.height = height + 'px';
        }
    };

    // Disable right mouse context menu.
    canvas_div.addEventListener('contextmenu', function (_e) {
        event.preventDefault();
        return false;
    });

    function set_focus() {
        canvas.focus();
        canvas_div.focus();
    }

    window.setTimeout(set_focus, 100);
};

mpl.figure.prototype._init_toolbar = function () {
    var fig = this;

    var toolbar = document.createElement('div');
    toolbar.classList = 'mpl-toolbar';
    this.root.appendChild(toolbar);

    function on_click_closure(name) {
        return function (_event) {
            return fig.toolbar_button_onclick(name);
        };
    }

    function on_mouseover_closure(tooltip) {
        return function (event) {
            if (!event.currentTarget.disabled) {
                return fig.toolbar_button_onmouseover(tooltip);
            }
        };
    }

    fig.buttons = {};
    var buttonGroup = document.createElement('div');
    buttonGroup.classList = 'mpl-button-group';
    for (var toolbar_ind in mpl.toolbar_items) {
        var name = mpl.toolbar_items[toolbar_ind][0];
        var tooltip = mpl.toolbar_items[toolbar_ind][1];
        var image = mpl.toolbar_items[toolbar_ind][2];
        var method_name = mpl.toolbar_items[toolbar_ind][3];

        if (!name) {
            /* Instead of a spacer, we start a new button group. */
            if (buttonGroup.hasChildNodes()) {
                toolbar.appendChild(buttonGroup);
            }
            buttonGroup = document.createElement('div');
            buttonGroup.classList = 'mpl-button-group';
            continue;
        }

        var button = (fig.buttons[name] = document.createElement('button'));
        button.classList = 'mpl-widget';
        button.setAttribute('role', 'button');
        button.setAttribute('aria-disabled', 'false');
        button.addEventListener('click', on_click_closure(method_name));
        button.addEventListener('mouseover', on_mouseover_closure(tooltip));

        var icon_img = document.createElement('img');
        icon_img.src = '_images/' + image + '.png';
        icon_img.srcset = '_images/' + image + '_large.png 2x';
        icon_img.alt = tooltip;
        button.appendChild(icon_img);

        buttonGroup.appendChild(button);
    }

    if (buttonGroup.hasChildNodes()) {
        toolbar.appendChild(buttonGroup);
    }

    var fmt_picker = document.createElement('select');
    fmt_picker.classList = 'mpl-widget';
    toolbar.appendChild(fmt_picker);
    this.format_dropdown = fmt_picker;

    for (var ind in mpl.extensions) {
        var fmt = mpl.extensions[ind];
        var option = document.createElement('option');
        option.selected = fmt === mpl.default_extension;
        option.innerHTML = fmt;
        fmt_picker.appendChild(option);
    }

    var status_bar = document.createElement('span');
    status_bar.classList = 'mpl-message';
    toolbar.appendChild(status_bar);
    this.message = status_bar;
};

mpl.figure.prototype.request_resize = function (x_pixels, y_pixels) {
    // Request matplotlib to resize the figure. Matplotlib will then trigger a resize in the client,
    // which will in turn request a refresh of the image.
    this.send_message('resize', { width: x_pixels, height: y_pixels });
};

mpl.figure.prototype.send_message = function (type, properties) {
    properties['type'] = type;
    properties['figure_id'] = this.id;
    this.ws.send(JSON.stringify(properties));
};

mpl.figure.prototype.send_draw_message = function () {
    if (!this.waiting) {
        this.waiting = true;
        this.ws.send(JSON.stringify({ type: 'draw', figure_id: this.id }));
    }
};

mpl.figure.prototype.handle_save = function (fig, _msg) {
    var format_dropdown = fig.format_dropdown;
    var format = format_dropdown.options[format_dropdown.selectedIndex].value;
    fig.ondownload(fig, format);
};

mpl.figure.prototype.handle_resize = function (fig, msg) {
    var size = msg['size'];
    if (size[0] !== fig.canvas.width || size[1] !== fig.canvas.height) {
        fig._resize_canvas(size[0], size[1], msg['forward']);
        fig.send_message('refresh', {});
    }
};

mpl.figure.prototype.handle_rubberband = function (fig, msg) {
    var x0 = msg['x0'] / fig.ratio;
    var y0 = (fig.canvas.height - msg['y0']) / fig.ratio;
    var x1 = msg['x1'] / fig.ratio;
    var y1 = (fig.canvas.height - msg['y1']) / fig.ratio;
    x0 = Math.floor(x0) + 0.5;
    y0 = Math.floor(y0) + 0.5;
    x1 = Math.floor(x1) + 0.5;
    y1 = Math.floor(y1) + 0.5;
    var min_x = Math.min(x0, x1);
    var min_y = Math.min(y0, y1);
    var width = Math.abs(x1 - x0);
    var height = Math.abs(y1 - y0);

    fig.rubberband_context.clearRect(
        0,
        0,
        fig.canvas.width / fig.ratio,
        fig.canvas.height / fig.ratio
    );

    fig.rubberband_context.strokeRect(min_x, min_y, width, height);
};

mpl.figure.prototype.handle_figure_label = function (fig, msg) {
    // Updates the figure title.
    fig.header.textContent = msg['label'];
};

mpl.figure.prototype.handle_cursor = function (fig, msg) {
    fig.canvas_div.style.cursor = msg['cursor'];
};

mpl.figure.prototype.handle_message = function (fig, msg) {
    fig.message.textContent = msg['message'];
};

mpl.figure.prototype.handle_draw = function (fig, _msg) {
    // Request the server to send over a new figure.
    fig.send_draw_message();
};

mpl.figure.prototype.handle_image_mode = function (fig, msg) {
    fig.image_mode = msg['mode'];
};

mpl.figure.prototype.handle_history_buttons = function (fig, msg) {
    for (var key in msg) {
        if (!(key in fig.buttons)) {
            continue;
        }
        fig.buttons[key].disabled = !msg[key];
        fig.buttons[key].setAttribute('aria-disabled', !msg[key]);
    }
};

mpl.figure.prototype.handle_navigate_mode = function (fig, msg) {
    if (msg['mode'] === 'PAN') {
        fig.buttons['Pan'].classList.add('active');
        fig.buttons['Zoom'].classList.remove('active');
    } else if (msg['mode'] === 'ZOOM') {
        fig.buttons['Pan'].classList.remove('active');
        fig.buttons['Zoom'].classList.add('active');
    } else {
        fig.buttons['Pan'].classList.remove('active');
        fig.buttons['Zoom'].classList.remove('active');
    }
};

mpl.figure.prototype.updated_canvas_event = function () {
    // Called whenever the canvas gets updated.
    this.send_message('ack', {});
};

// A function to construct a web socket function for onmessage handling.
// Called in the figure constructor.
mpl.figure.prototype._make_on_message_function = function (fig) {
    return function socket_on_message(evt) {
        if (evt.data instanceof Blob) {
            var img = evt.data;
            if (img.type !== 'image/png') {
                /* FIXME: We get "Resource interpreted as Image but
                 * transferred with MIME type text/plain:" errors on
                 * Chrome.  But how to set the MIME type?  It doesn't seem
                 * to be part of the websocket stream */
                img.type = 'image/png';
            }

            /* Free the memory for the previous frames */
            if (fig.imageObj.src) {
                (window.URL || window.webkitURL).revokeObjectURL(
                    fig.imageObj.src
                );
            }

            fig.imageObj.src = (window.URL || window.webkitURL).createObjectURL(
                img
            );
            fig.updated_canvas_event();
            fig.waiting = false;
            return;
        } else if (
            typeof evt.data === 'string' &&
            evt.data.slice(0, 21) === 'data:image/png;base64'
        ) {
            fig.imageObj.src = evt.data;
            fig.updated_canvas_event();
            fig.waiting = false;
            return;
        }

        var msg = JSON.parse(evt.data);
        var msg_type = msg['type'];

        // Call the  "handle_{type}" callback, which takes
        // the figure and JSON message as its only arguments.
        try {
            var callback = fig['handle_' + msg_type];
        } catch (e) {
            console.log(
                "No handler for the '" + msg_type + "' message type: ",
                msg
            );
            return;
        }

        if (callback) {
            try {
                // console.log("Handling '" + msg_type + "' message: ", msg);
                callback(fig, msg);
            } catch (e) {
                console.log(
                    "Exception inside the 'handler_" + msg_type + "' callback:",
                    e,
                    e.stack,
                    msg
                );
            }
        }
    };
};


/*
 * return a copy of an object with only non-object keys
 * we need this to avoid circular references
 * https://stackoverflow.com/a/24161582/3208463
 */
function simpleKeys(original) {
    return Object.keys(original).reduce(function (obj, key) {
        if (typeof original[key] !== 'object') {
            obj[key] = original[key];
        }
        return obj;
    }, {});
}

mpl.figure.prototype.mouse_event = function (event, name) {
    if (name === 'button_press') {
        this.canvas.focus();
        this.canvas_div.focus();
    }

    // from https://stackoverflow.com/q/1114465
    var boundingRect = this.canvas.getBoundingClientRect();
    var x = (event.clientX - boundingRect.left) * this.ratio;
    var y = (event.clientY - boundingRect.top) * this.ratio;

    this.send_message(name, {
        x: x,
        y: y,
        button: event.button,
        step: event.step,
        guiEvent: simpleKeys(event),
    });

    return false;
};

mpl.figure.prototype._key_event_extra = function (_event, _name) {
    // Handle any extra behaviour associated with a key event
};

mpl.figure.prototype.key_event = function (event, name) {
    // Prevent repeat events
    if (name === 'key_press') {
        if (event.key === this._key) {
            return;
        } else {
            this._key = event.key;
        }
    }
    if (name === 'key_release') {
        this._key = null;
    }

    var value = '';
    if (event.ctrlKey && event.key !== 'Control') {
        value += 'ctrl+';
    }
    else if (event.altKey && event.key !== 'Alt') {
        value += 'alt+';
    }
    else if (event.shiftKey && event.key !== 'Shift') {
        value += 'shift+';
    }

    value += 'k' + event.key;

    this._key_event_extra(event, name);

    this.send_message(name, { key: value, guiEvent: simpleKeys(event) });
    return false;
};

mpl.figure.prototype.toolbar_button_onclick = function (name) {
    if (name === 'download') {
        this.handle_save(this, null);
    } else {
        this.send_message('toolbar_button', { name: name });
    }
};

mpl.figure.prototype.toolbar_button_onmouseover = function (tooltip) {
    this.message.textContent = tooltip;
};

///////////////// REMAINING CONTENT GENERATED BY embed_js.py /////////////////
// prettier-ignore
var _JSXTOOLS_RESIZE_OBSERVER=function(A){var t,i=new WeakMap,n=new WeakMap,a=new WeakMap,r=new WeakMap,o=new Set;function s(e){if(!(this instanceof s))throw new TypeError("Constructor requires 'new' operator");i.set(this,e)}function h(){throw new TypeError("Function is not a constructor")}function c(e,t,i,n){e=0 in arguments?Number(arguments[0]):0,t=1 in arguments?Number(arguments[1]):0,i=2 in arguments?Number(arguments[2]):0,n=3 in arguments?Number(arguments[3]):0,this.right=(this.x=this.left=e)+(this.width=i),this.bottom=(this.y=this.top=t)+(this.height=n),Object.freeze(this)}function d(){t=requestAnimationFrame(d);var s=new WeakMap,p=new Set;o.forEach((function(t){r.get(t).forEach((function(i){var r=t instanceof window.SVGElement,o=a.get(t),d=r?0:parseFloat(o.paddingTop),f=r?0:parseFloat(o.paddingRight),l=r?0:parseFloat(o.paddingBottom),u=r?0:parseFloat(o.paddingLeft),g=r?0:parseFloat(o.borderTopWidth),m=r?0:parseFloat(o.borderRightWidth),w=r?0:parseFloat(o.borderBottomWidth),b=u+f,F=d+l,v=(r?0:parseFloat(o.borderLeftWidth))+m,W=g+w,y=r?0:t.offsetHeight-W-t.clientHeight,E=r?0:t.offsetWidth-v-t.clientWidth,R=b+v,z=F+W,M=r?t.width:parseFloat(o.width)-R-E,O=r?t.height:parseFloat(o.height)-z-y;if(n.has(t)){var k=n.get(t);if(k[0]===M&&k[1]===O)return}n.set(t,[M,O]);var S=Object.create(h.prototype);S.target=t,S.contentRect=new c(u,d,M,O),s.has(i)||(s.set(i,[]),p.add(i)),s.get(i).push(S)}))})),p.forEach((function(e){i.get(e).call(e,s.get(e),e)}))}return s.prototype.observe=function(i){if(i instanceof window.Element){r.has(i)||(r.set(i,new Set),o.add(i),a.set(i,window.getComputedStyle(i)));var n=r.get(i);n.has(this)||n.add(this),cancelAnimationFrame(t),t=requestAnimationFrame(d)}},s.prototype.unobserve=function(i){if(i instanceof window.Element&&r.has(i)){var n=r.get(i);n.has(this)&&(n.delete(this),n.size||(r.delete(i),o.delete(i))),n.size||r.delete(i),o.size||cancelAnimationFrame(t)}},A.DOMRectReadOnly=c,A.ResizeObserver=s,A.ResizeObserverEntry=h,A}; // eslint-disable-line
mpl.toolbar_items = [["Home", "Reset original view", "fa fa-home", "home"], ["Back", "Back to previous view", "fa fa-arrow-left", "back"], ["Forward", "Forward to next view", "fa fa-arrow-right", "forward"], ["", "", "", ""], ["Pan", "Left button pans, Right button zooms\nx/y fixes axis, CTRL fixes aspect", "fa fa-arrows", "pan"], ["Zoom", "Zoom to rectangle\nx/y fixes axis", "fa fa-square-o", "zoom"], ["", "", "", ""], ["Download", "Download plot", "fa fa-floppy-o", "download"]];

mpl.extensions = ["eps", "jpeg", "pgf", "pdf", "png", "ps", "raw", "svg", "tif", "webp"];

mpl.default_extension = "png";/* global mpl */

var comm_websocket_adapter = function (comm) {
    // Create a "websocket"-like object which calls the given IPython comm
    // object with the appropriate methods. Currently this is a non binary
    // socket, so there is still some room for performance tuning.
    var ws = {};

    ws.binaryType = comm.kernel.ws.binaryType;
    ws.readyState = comm.kernel.ws.readyState;
    function updateReadyState(_event) {
        if (comm.kernel.ws) {
            ws.readyState = comm.kernel.ws.readyState;
        } else {
            ws.readyState = 3; // Closed state.
        }
    }
    comm.kernel.ws.addEventListener('open', updateReadyState);
    comm.kernel.ws.addEventListener('close', updateReadyState);
    comm.kernel.ws.addEventListener('error', updateReadyState);

    ws.close = function () {
        comm.close();
    };
    ws.send = function (m) {
        //console.log('sending', m);
        comm.send(m);
    };
    // Register the callback with on_msg.
    comm.on_msg(function (msg) {
        //console.log('receiving', msg['content']['data'], msg);
        var data = msg['content']['data'];
        if (data['blob'] !== undefined) {
            data = {
                data: new Blob(msg['buffers'], { type: data['blob'] }),
            };
        }
        // Pass the mpl event to the overridden (by mpl) onmessage function.
        ws.onmessage(data);
    });
    return ws;
};

mpl.mpl_figure_comm = function (comm, msg) {
    // This is the function which gets called when the mpl process
    // starts-up an IPython Comm through the "matplotlib" channel.

    var id = msg.content.data.id;
    // Get hold of the div created by the display call when the Comm
    // socket was opened in Python.
    var element = document.getElementById(id);
    var ws_proxy = comm_websocket_adapter(comm);

    function ondownload(figure, _format) {
        window.open(figure.canvas.toDataURL());
    }

    var fig = new mpl.figure(id, ws_proxy, ondownload, element);

    // Call onopen now - mpl needs it, as it is assuming we've passed it a real
    // web socket which is closed, not our websocket->open comm proxy.
    ws_proxy.onopen();

    fig.parent_element = element;
    fig.cell_info = mpl.find_output_cell("<div id='" + id + "'></div>");
    if (!fig.cell_info) {
        console.error('Failed to find cell for figure', id, fig);
        return;
    }
    fig.cell_info[0].output_area.element.on(
        'cleared',
        { fig: fig },
        fig._remove_fig_handler
    );
};

mpl.figure.prototype.handle_close = function (fig, msg) {
    var width = fig.canvas.width / fig.ratio;
    fig.cell_info[0].output_area.element.off(
        'cleared',
        fig._remove_fig_handler
    );
    fig.resizeObserverInstance.unobserve(fig.canvas_div);

    // Update the output cell to use the data from the current canvas.
    fig.push_to_output();
    var dataURL = fig.canvas.toDataURL();
    // Re-enable the keyboard manager in IPython - without this line, in FF,
    // the notebook keyboard shortcuts fail.
    IPython.keyboard_manager.enable();
    fig.parent_element.innerHTML =
        '<img src="' + dataURL + '" width="' + width + '">';
    fig.close_ws(fig, msg);
};

mpl.figure.prototype.close_ws = function (fig, msg) {
    fig.send_message('closing', msg);
    // fig.ws.close()
};

mpl.figure.prototype.push_to_output = function (_remove_interactive) {
    // Turn the data on the canvas into data in the output cell.
    var width = this.canvas.width / this.ratio;
    var dataURL = this.canvas.toDataURL();
    this.cell_info[1]['text/html'] =
        '<img src="' + dataURL + '" width="' + width + '">';
};

mpl.figure.prototype.updated_canvas_event = function () {
    // Tell IPython that the notebook contents must change.
    IPython.notebook.set_dirty(true);
    this.send_message('ack', {});
    var fig = this;
    // Wait a second, then push the new image to the DOM so
    // that it is saved nicely (might be nice to debounce this).
    setTimeout(function () {
        fig.push_to_output();
    }, 1000);
};

mpl.figure.prototype._init_toolbar = function () {
    var fig = this;

    var toolbar = document.createElement('div');
    toolbar.classList = 'btn-toolbar';
    this.root.appendChild(toolbar);

    function on_click_closure(name) {
        return function (_event) {
            return fig.toolbar_button_onclick(name);
        };
    }

    function on_mouseover_closure(tooltip) {
        return function (event) {
            if (!event.currentTarget.disabled) {
                return fig.toolbar_button_onmouseover(tooltip);
            }
        };
    }

    fig.buttons = {};
    var buttonGroup = document.createElement('div');
    buttonGroup.classList = 'btn-group';
    var button;
    for (var toolbar_ind in mpl.toolbar_items) {
        var name = mpl.toolbar_items[toolbar_ind][0];
        var tooltip = mpl.toolbar_items[toolbar_ind][1];
        var image = mpl.toolbar_items[toolbar_ind][2];
        var method_name = mpl.toolbar_items[toolbar_ind][3];

        if (!name) {
            /* Instead of a spacer, we start a new button group. */
            if (buttonGroup.hasChildNodes()) {
                toolbar.appendChild(buttonGroup);
            }
            buttonGroup = document.createElement('div');
            buttonGroup.classList = 'btn-group';
            continue;
        }

        button = fig.buttons[name] = document.createElement('button');
        button.classList = 'btn btn-default';
        button.href = '#';
        button.title = name;
        button.innerHTML = '<i class="fa ' + image + ' fa-lg"></i>';
        button.addEventListener('click', on_click_closure(method_name));
        button.addEventListener('mouseover', on_mouseover_closure(tooltip));
        buttonGroup.appendChild(button);
    }

    if (buttonGroup.hasChildNodes()) {
        toolbar.appendChild(buttonGroup);
    }

    // Add the status bar.
    var status_bar = document.createElement('span');
    status_bar.classList = 'mpl-message pull-right';
    toolbar.appendChild(status_bar);
    this.message = status_bar;

    // Add the close button to the window.
    var buttongrp = document.createElement('div');
    buttongrp.classList = 'btn-group inline pull-right';
    button = document.createElement('button');
    button.classList = 'btn btn-mini btn-primary';
    button.href = '#';
    button.title = 'Stop Interaction';
    button.innerHTML = '<i class="fa fa-power-off icon-remove icon-large"></i>';
    button.addEventListener('click', function (_evt) {
        fig.handle_close(fig, {});
    });
    button.addEventListener(
        'mouseover',
        on_mouseover_closure('Stop Interaction')
    );
    buttongrp.appendChild(button);
    var titlebar = this.root.querySelector('.ui-dialog-titlebar');
    titlebar.insertBefore(buttongrp, titlebar.firstChild);
};

mpl.figure.prototype._remove_fig_handler = function (event) {
    var fig = event.data.fig;
    if (event.target !== this) {
        // Ignore bubbled events from children.
        return;
    }
    fig.close_ws(fig, {});
};

mpl.figure.prototype._root_extra_style = function (el) {
    el.style.boxSizing = 'content-box'; // override notebook setting of border-box.
};

mpl.figure.prototype._canvas_extra_style = function (el) {
    // this is important to make the div 'focusable
    el.setAttribute('tabindex', 0);
    // reach out to IPython and tell the keyboard manager to turn it's self
    // off when our div gets focus

    // location in version 3
    if (IPython.notebook.keyboard_manager) {
        IPython.notebook.keyboard_manager.register_events(el);
    } else {
        // location in version 2
        IPython.keyboard_manager.register_events(el);
    }
};

mpl.figure.prototype._key_event_extra = function (event, _name) {
    // Check for shift+enter
    if (event.shiftKey && event.which === 13) {
        this.canvas_div.blur();
        // select the cell after this one
        var index = IPython.notebook.find_cell_index(this.cell_info[0]);
        IPython.notebook.select(index + 1);
    }
};

mpl.figure.prototype.handle_save = function (fig, _msg) {
    fig.ondownload(fig, null);
};

mpl.find_output_cell = function (html_output) {
    // Return the cell and output element which can be found *uniquely* in the notebook.
    // Note - this is a bit hacky, but it is done because the "notebook_saving.Notebook"
    // IPython event is triggered only after the cells have been serialised, which for
    // our purposes (turning an active figure into a static one), is too late.
    var cells = IPython.notebook.get_cells();
    var ncells = cells.length;
    for (var i = 0; i < ncells; i++) {
        var cell = cells[i];
        if (cell.cell_type === 'code') {
            for (var j = 0; j < cell.output_area.outputs.length; j++) {
                var data = cell.output_area.outputs[j];
                if (data.data) {
                    // IPython >= 3 moved mimebundle to data attribute of output
                    data = data.data;
                }
                if (data['text/html'] === html_output) {
                    return [cell, data, j];
                }
            }
        }
    }
};

// Register the function which deals with the matplotlib target/channel.
// The kernel may be null if the page has been refreshed.
if (IPython.notebook.kernel !== null) {
    IPython.notebook.kernel.comm_manager.register_target(
        'matplotlib',
        mpl.mpl_figure_comm
    );
}

</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div id='4e800f3c-d29c-431b-b716-24355939b205'></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
i:  0
Matrix([[0.200652405858808]])
Matrix([[0.113874846476112]])
Matrix([[0.205565960700685]])
Matrix([[0.0556261287052016]])
Matrix([[0.205937189440296]])
Matrix([[0.0556261287052016]])
Compare
[[ 8.66025400e-01  2.08929909e-17 -5.00000000e-01]
 [ 2.01497592e-21  1.00000000e+00 -4.17287452e-17]
 [ 5.00000000e-01 -3.61776890e-17  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [ 1.30000000e-01 -9.40619915e-18  2.25166604e-01]
i:  1
Matrix([[0.200464197426834]])
Matrix([[0.113630557404181]])
Matrix([[0.205358968165558]])
Matrix([[0.0556366211930191]])
Matrix([[0.205732193354102]])
Matrix([[0.0557051759365938]])
Compare
[[ 8.66025400e-01 -1.88842018e-17 -5.00000000e-01]
 [ 5.01891646e-19  1.00000000e+00  3.79858419e-17]
 [ 5.00000000e-01  3.29499332e-17  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [1.30000000e-01 8.56698262e-18 2.25166604e-01]
i:  2
Matrix([[0.199785565147066]])
Matrix([[0.112838490615058]])
Matrix([[0.204665682479924]])
Matrix([[0.0556692671887738]])
Matrix([[0.204959983456642]])
Matrix([[0.0559524087384013]])
Compare
[[ 8.66025400e-01  3.46676086e-17 -5.00000000e-01]
 [ 1.23558295e-18  1.00000000e+00 -7.18704038e-17]
 [ 5.00000000e-01 -6.24049710e-17  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [ 1.30000000e-01 -1.62252925e-17  2.25166604e-01]
i:  3
Matrix([[0.198591051556393]])
Matrix([[0.111699293718025]])
Matrix([[0.203593181867003]])
Matrix([[0.0557151078876275]])
Matrix([[0.203485639625737]])
Matrix([[0.0562810757471112]])
Compare
[[ 8.66025400e-01  1.56205193e-17 -5.00000000e-01]
 [-8.69233573e-19  1.00000000e+00 -3.35792459e-17]
 [ 5.00000000e-01 -2.88602560e-17  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [ 1.30000000e-01 -7.50366657e-18  2.25166604e-01]
i:  4
Matrix([[0.197196260789123]])
Matrix([[0.110688127890502]])
Matrix([[0.202549627925695]])
Matrix([[0.0557605326487339]])
Matrix([[0.201616903223953]])
Matrix([[0.0565494426098182]])
Compare
[[ 8.66025400e-01 -7.96849266e-18 -5.00000000e-01]
 [ 1.54410448e-19  1.00000000e+00  1.08808800e-17]
 [ 5.00000000e-01  8.02577976e-18  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [1.30000000e-01 2.08670274e-18 2.25166604e-01]
i:  5
Matrix([[0.195978520992071]])
Matrix([[0.110058019702853]])
Matrix([[0.201849886684243]])
Matrix([[0.0557972686342503]])
Matrix([[0.199897177573393]])
Matrix([[0.0567088889879161]])
Compare
[[ 8.66025400e-01 -5.50941382e-17 -5.00000000e-01]
 [ 1.03734162e-18  1.00000000e+00  1.12973066e-16]
 [ 5.00000000e-01  9.81308049e-17  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [1.30000000e-01 2.55140093e-17 2.25166604e-01]
i:  6
Matrix([[0.195102434476325]])
Matrix([[0.109779513369715]])
Matrix([[0.201524217506006]])
Matrix([[0.0558220574068817]])
Matrix([[0.198620772328339]])
Matrix([[0.0567777478181446]])
Compare
[[ 8.66025400e-01 -4.98682638e-17 -5.00000000e-01]
 [ 8.90269652e-19  1.00000000e+00  1.00925728e-16]
 [ 5.00000000e-01  8.79179480e-17  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [1.30000000e-01 2.28586665e-17 2.25166604e-01]
i:  7
Matrix([[0.194540065791544]])
Matrix([[0.109725189797687]])
Matrix([[0.201447227105906]])
Matrix([[0.0558371244751695]])
Matrix([[0.197772390582585]])
Matrix([[0.0567862238790339]])
Compare
[[ 8.66025400e-01 -5.88324198e-17 -5.00000000e-01]
 [-6.88817889e-19  1.00000000e+00  1.17533907e-16]
 [ 5.00000000e-01  1.01707860e-16  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [1.30000000e-01 2.64440436e-17 2.25166604e-01]
i:  8
Matrix([[0.194193100424057]])
Matrix([[0.109771253721704]])
Matrix([[0.201484424087798]])
Matrix([[0.0558463265903783]])
Matrix([[0.197227383912645]])
Matrix([[0.0567615364009154]])
Compare
[[ 8.66025400e-01 -2.78186774e-17 -5.00000000e-01]
 [ 3.88832243e-19  1.00000000e+00  5.70632787e-17]
 [ 5.00000000e-01  4.92632927e-17  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [1.30000000e-01 1.28084561e-17 2.25166604e-01]
i:  9
Matrix([[0.193971915373273]])
Matrix([[0.109835896331777]])
Matrix([[0.201543007848993]])
Matrix([[0.0558525473874137]])
Matrix([[0.196865465949048]])
Matrix([[0.0567240193961370]])
Compare
[[ 8.66025400e-01  1.49397716e-17 -5.00000000e-01]
 [ 7.54498114e-20  1.00000000e+00 -2.79872162e-17]
 [ 5.00000000e-01 -2.43343222e-17  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [ 1.30000000e-01 -6.32692376e-18  2.25166604e-01]
i:  10
Matrix([[0.193822549289113]])
Matrix([[0.109883546237539]])
Matrix([[0.201579645395266]])
Matrix([[0.0558572831165495]])
Matrix([[0.196609507011765]])
Matrix([[0.0566865003985952]])
Compare
[[ 8.66025400e-01  1.07947130e-19 -5.00000000e-01]
 [-2.75657700e-19  1.00000000e+00  5.27394948e-19]
 [ 5.00000000e-01  4.16298299e-19  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [1.30000000e-01 1.08237558e-19 2.25166604e-01]
i:  11
Matrix([[0.193721120920278]])
Matrix([[0.109908832453315]])
Matrix([[0.201590528120759]])
Matrix([[0.0558610046703323]])
Matrix([[0.196428462651993]])
Matrix([[0.0566561822469021]])
Compare
[[ 8.66025400e-01  3.63560368e-17 -5.00000000e-01]
 [ 7.74995627e-20  1.00000000e+00 -7.23523453e-17]
 [ 5.00000000e-01 -6.23253647e-17  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [ 1.30000000e-01 -1.62045948e-17  2.25166604e-01]
i:  12
Matrix([[0.193658138092893]])
Matrix([[0.109919088433488]])
Matrix([[0.201588524349653]])
Matrix([[0.0558636413390986]])
Matrix([[0.196313139018673]])
Matrix([[0.0566359134666801]])
Compare
[[ 8.66025400e-01 -6.03511779e-17 -5.00000000e-01]
 [ 1.18883651e-19  1.00000000e+00  1.21020475e-16]
 [ 5.00000000e-01  1.04909824e-16  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [1.30000000e-01 2.72765543e-17 2.25166604e-01]
i:  13
Matrix([[0.193625328368193]])
Matrix([[0.109922287899392]])
Matrix([[0.201584433638831]])
Matrix([[0.0558651879223760]])
Matrix([[0.196252352027075]])
Matrix([[0.0566250015227241]])
Compare
[[ 8.66025400e-01  2.70085048e-17 -5.00000000e-01]
 [-1.31503602e-20  1.00000000e+00 -5.39593163e-17]
 [ 5.00000000e-01 -4.66552947e-17  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [ 1.30000000e-01 -1.21303766e-17  2.25166604e-01]
i:  14
Matrix([[0.193611907101886]])
Matrix([[0.109923037013635]])
Matrix([[0.201582024733209]])
Matrix([[0.0558658957167918]])
Matrix([[0.196227325877905]])
Matrix([[0.0566204650723440]])
Compare
[[ 8.66025400e-01 -6.26047161e-17 -5.00000000e-01]
 [-2.33229701e-20  1.00000000e+00  1.25169014e-16]
 [ 5.00000000e-01  1.08369388e-16  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [1.30000000e-01 2.81760408e-17 2.25166604e-01]
i:  15
Matrix([[0.193607794162576]])
Matrix([[0.109923161305813]])
Matrix([[0.201581137345032]])
Matrix([[0.0558661458818032]])
Matrix([[0.196219599928836]])
Matrix([[0.0566190679235582]])
Compare
[[ 8.66025400e-01 -7.52298724e-17 -5.00000000e-01]
 [-1.98617141e-21  1.00000000e+00  1.50435162e-16]
 [ 5.00000000e-01  1.30281771e-16  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [1.30000000e-01 3.38732605e-17 2.25166604e-01]
i:  16
Matrix([[0.193606882734149]])
Matrix([[0.109923171256572]])
Matrix([[0.201580913321427]])
Matrix([[0.0558662064822084]])
Matrix([[0.196217870954272]])
Matrix([[0.0566187578856053]])
Compare
[[ 8.66025400e-01 -3.16182854e-17 -5.00000000e-01]
 [ 8.58154627e-22  1.00000000e+00  6.32401072e-17]
 [ 5.00000000e-01  5.47669875e-17  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [1.30000000e-01 1.42394168e-17 2.25166604e-01]
i:  17
Matrix([[0.193606741317178]])
Matrix([[0.109923173128898]])
Matrix([[0.201580874558851]])
Matrix([[0.0558662200884570]])
Matrix([[0.196217596162483]])
Matrix([[0.0566187106701023]])
Compare
[[ 8.66025400e-01 -2.67896254e-17 -5.00000000e-01]
 [-7.08740581e-22  1.00000000e+00  5.35870702e-17]
 [ 5.00000000e-01  4.64057323e-17  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [1.30000000e-01 1.20654904e-17 2.25166604e-01]
i:  18
Matrix([[0.193606728196559]])
Matrix([[0.109923172310622]])
Matrix([[0.201580872004251]])
Matrix([[0.0558662209414493]])
Matrix([[0.196217569850389]])
Matrix([[0.0566187060352217]])
Compare
[[ 8.66025400e-01  4.14219457e-18 -5.00000000e-01]
 [-6.16918064e-21  1.00000000e+00 -8.27898568e-18]
 [ 5.00000000e-01 -7.16409283e-18  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [ 1.30000000e-01 -1.86266414e-18  2.25166604e-01]
i:  19
Matrix([[0.193606740688201]])
Matrix([[0.109923178705195]])
Matrix([[0.201580883995420]])
Matrix([[0.0558662303576911]])
Matrix([[0.196217574854985]])
Matrix([[0.0566187110900983]])
Compare
[[ 8.66025400e-01 -1.10289229e-16 -5.00000000e-01]
 [-1.74908901e-20  1.00000000e+00  2.20540429e-16]
 [ 5.00000000e-01  1.90997215e-16  8.66025400e-01]]
[[ 0.8660254  0.        -0.5      ]
 [ 0.         1.         0.       ]
 [ 0.5        0.         0.8660254]]
Pos_BodyOnSupport_Target:  [1.30000000e-01 4.96592759e-17 2.25166604e-01]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../install.html" class="btn btn-neutral float-left" title="Install" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../controlflow.html" class="btn btn-neutral float-right" title="Control Flow" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, KZ.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>